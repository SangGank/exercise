/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=7)})([function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActionsEnhanced/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/uiActions/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/embeddable/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8);var _node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_urlDrilldown_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/urlDrilldown/public",__webpack_require__,9)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["urlDrilldown"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var public_=__webpack_require__(0);var external_kbnSharedDeps_React_=__webpack_require__(2);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var kibanaReact_public_=__webpack_require__(4);var uiActions_public_=__webpack_require__(1);var embeddable_public_=__webpack_require__(3);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}function getContextScope(contextScopeInput){var _output$title,_output$savedObjectId;function hasEmbeddable(val){if(val&&typeof val==="object"&&"embeddable"in val)return true;return false}if(!hasEmbeddable(contextScopeInput))throw new Error("UrlDrilldown [getContextScope] can't build scope because embeddable object is missing in context");var embeddable=contextScopeInput.embeddable;var input=embeddable.getInput();var output=embeddable.getOutput();function hasSavedObjectId(obj){return"savedObjectId"in obj&&typeof obj.savedObjectId==="string"}function getIndexPatternIds(){function hasIndexPatterns(_output){return"indexPatterns"in _output&&Array.isArray(_output.indexPatterns)&&_output.indexPatterns.length>0}return hasIndexPatterns(output)?output.indexPatterns.map((function(ip){return ip.id})).filter(Boolean):[]}var indexPatternsIds=getIndexPatternIds();return{panel:cleanEmptyKeys({id:input.id,title:(_output$title=output.title)!==null&&_output$title!==void 0?_output$title:input.title,savedObjectId:(_output$savedObjectId=output.savedObjectId)!==null&&_output$savedObjectId!==void 0?_output$savedObjectId:hasSavedObjectId(input)?input.savedObjectId:undefined,query:input.query,timeRange:input.timeRange,filters:input.filters,indexPatternIds:indexPatternsIds.length>1?indexPatternsIds:undefined,indexPatternId:indexPatternsIds.length===1?indexPatternsIds[0]:undefined})}}function getEventScope(eventScopeInput){if(Object(embeddable_public_["isRangeSelectTriggerContext"])(eventScopeInput)){return getEventScopeFromRangeSelectTriggerContext(eventScopeInput)}else if(Object(embeddable_public_["isValueClickTriggerContext"])(eventScopeInput)){return getEventScopeFromValueClickTriggerContext(eventScopeInput)}else{throw new Error("UrlDrilldown [getEventScope] can't build scope from not supported trigger")}}function getEventScopeFromRangeSelectTriggerContext(eventScopeInput){var _column$meta,_column$meta$aggConfi;var _eventScopeInput$data=eventScopeInput.data,table=_eventScopeInput$data.table,columnIndex=_eventScopeInput$data.column,range=_eventScopeInput$data.range;var column=table.columns[columnIndex];return cleanEmptyKeys({key:toPrimitiveOrUndefined(column===null||column===void 0?void 0:(_column$meta=column.meta)===null||_column$meta===void 0?void 0:(_column$meta$aggConfi=_column$meta.aggConfigParams)===null||_column$meta$aggConfi===void 0?void 0:_column$meta$aggConfi.field),from:toPrimitiveOrUndefined(range[0]),to:toPrimitiveOrUndefined(range[range.length-1])})}function getEventScopeFromValueClickTriggerContext(eventScopeInput){var _eventScopeInput$data2,_points$,_points$2;var negate=(_eventScopeInput$data2=eventScopeInput.data.negate)!==null&&_eventScopeInput$data2!==void 0?_eventScopeInput$data2:false;var points=eventScopeInput.data.data.map((function(_ref){var _column$meta2,_column$meta2$aggConf;var table=_ref.table,value=_ref.value,columnIndex=_ref.column;var column=table.columns[columnIndex];return{value:toPrimitiveOrUndefined(value),key:toPrimitiveOrUndefined(column===null||column===void 0?void 0:(_column$meta2=column.meta)===null||_column$meta2===void 0?void 0:(_column$meta2$aggConf=_column$meta2.aggConfigParams)===null||_column$meta2$aggConf===void 0?void 0:_column$meta2$aggConf.field)}}));return cleanEmptyKeys({key:(_points$=points[0])===null||_points$===void 0?void 0:_points$.key,value:(_points$2=points[0])===null||_points$2===void 0?void 0:_points$2.value,negate:negate,points:points})}function getMockEventScope(_ref2){var _ref3=_slicedToArray(_ref2,1),trigger=_ref3[0];if(trigger===uiActions_public_["SELECT_RANGE_TRIGGER"]){return{key:"event.key",from:new Date(Date.now()-15*60*1e3).toISOString(),to:(new Date).toISOString()}}else{var nPoints=4;var points=new Array(nPoints).fill(0).map((function(_,index){return{key:"event.points.".concat(index,".key"),value:"event.points.".concat(index,".value")}}));return{key:"event.key",value:"event.value",negate:false,points:points}}}function toPrimitiveOrUndefined(v){if(typeof v==="number"||typeof v==="boolean"||typeof v==="string"||v===null)return v;if(typeof v==="object"&&v instanceof Date)return v.toISOString();if(typeof v==="undefined")return undefined;return String(v)}function cleanEmptyKeys(obj){Object.keys(obj).forEach((function(key){if(obj[key]===undefined){delete obj[key]}}));return obj}var external_kbnSharedDeps_KbnI18n_=__webpack_require__(5);var txtUrlDrilldownDisplayName=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.urlDrilldown.DisplayName",{defaultMessage:"Go to URL"});function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var URL_DRILLDOWN="URL_DRILLDOWN";var url_drilldown_UrlDrilldown=function(){function UrlDrilldown(deps){var _this=this;_classCallCheck(this,UrlDrilldown);this.deps=deps;_defineProperty(this,"id",URL_DRILLDOWN);_defineProperty(this,"order",8);_defineProperty(this,"minimalLicense","gold");_defineProperty(this,"licenseFeatureName","URL drilldown");_defineProperty(this,"isBeta",true);_defineProperty(this,"getDisplayName",(function(){return txtUrlDrilldownDisplayName}));_defineProperty(this,"euiIcon","link");_defineProperty(this,"ReactCollectConfig",(function(_ref){var config=_ref.config,onConfig=_ref.onConfig,context=_ref.context;var scope=external_kbnSharedDeps_React_default.a.useMemo((function(){return _this.buildEditorScope(context)}),[context]);return external_kbnSharedDeps_React_default.a.createElement(public_["UrlDrilldownCollectConfig"],{config:config,onConfig:onConfig,scope:scope,syntaxHelpDocsLink:_this.deps.getSyntaxHelpDocsLink(),variablesHelpDocsLink:_this.deps.getVariablesHelpDocsLink()})}));_defineProperty(this,"CollectConfig",Object(kibanaReact_public_["reactToUiComponent"])(this.ReactCollectConfig));_defineProperty(this,"createConfig",(function(){return{url:{template:""},openInNewTab:false}}));_defineProperty(this,"isConfigValid",(function(config,context){var _urlDrilldownValidate=Object(public_["urlDrilldownValidateUrlTemplate"])(config.url,_this.buildEditorScope(context)),isValid=_urlDrilldownValidate.isValid;return isValid}));_defineProperty(this,"isCompatible",function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee(config,context){var _urlDrilldownValidate2,isValid,error;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.t0=public_["urlDrilldownValidateUrlTemplate"];_context.t1=config.url;_context.next=4;return _this.buildRuntimeScope(context);case 4:_context.t2=_context.sent;_urlDrilldownValidate2=(0,_context.t0)(_context.t1,_context.t2);isValid=_urlDrilldownValidate2.isValid;error=_urlDrilldownValidate2.error;if(!isValid){console.warn("UrlDrilldown [".concat(config.url.template,"] is not valid. Error [").concat(error,"]. Skipping execution."))}return _context.abrupt("return",Promise.resolve(isValid));case 10:case"end":return _context.stop()}}}),_callee)})));return function(_x,_x2){return _ref2.apply(this,arguments)}}());_defineProperty(this,"getHref",function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(config,context){return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",Object(public_["urlDrilldownCompileUrl"])(config.url.template,_this.buildRuntimeScope(context)));case 1:case"end":return _context2.stop()}}}),_callee2)})));return function(_x3,_x4){return _ref3.apply(this,arguments)}}());_defineProperty(this,"execute",function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark((function _callee3(config,context){var url;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:url=Object(public_["urlDrilldownCompileUrl"])(config.url.template,_this.buildRuntimeScope(context));if(!config.openInNewTab){_context3.next=5;break}window.open(url,"_blank","noopener");_context3.next=7;break;case 5:_context3.next=7;return _this.deps.navigateToUrl(url);case 7:case"end":return _context3.stop()}}}),_callee3)})));return function(_x5,_x6){return _ref4.apply(this,arguments)}}());_defineProperty(this,"buildEditorScope",(function(context){return Object(public_["urlDrilldownBuildScope"])({globalScope:_this.deps.getGlobalScope(),contextScope:getContextScope(context),eventScope:getMockEventScope(context.triggers)})}));_defineProperty(this,"buildRuntimeScope",(function(context){return Object(public_["urlDrilldownBuildScope"])({globalScope:_this.deps.getGlobalScope(),contextScope:getContextScope(context),eventScope:getEventScope(context)})}))}_createClass(UrlDrilldown,[{key:"supportedTriggers",value:function supportedTriggers(){return[uiActions_public_["VALUE_CLICK_TRIGGER"],uiActions_public_["SELECT_RANGE_TRIGGER"]]}}]);return UrlDrilldown}();var kibanaUtils_public_=__webpack_require__(6);function plugin_slicedToArray(arr,i){return plugin_arrayWithHoles(arr)||plugin_iterableToArrayLimit(arr,i)||plugin_unsupportedIterableToArray(arr,i)||plugin_nonIterableRest()}function plugin_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function plugin_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return plugin_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return plugin_arrayLikeToArray(o,minLen)}function plugin_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function plugin_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function plugin_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function plugin_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function plugin_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function plugin_createClass(Constructor,protoProps,staticProps){if(protoProps)plugin_defineProperties(Constructor.prototype,protoProps);if(staticProps)plugin_defineProperties(Constructor,staticProps);return Constructor}var plugin_UrlDrilldownPlugin=function(){function UrlDrilldownPlugin(context){plugin_classCallCheck(this,UrlDrilldownPlugin);this.context=context}plugin_createClass(UrlDrilldownPlugin,[{key:"setup",value:function setup(core,plugins){var startServices=Object(kibanaUtils_public_["createStartServicesGetter"])(core.getStartServices);plugins.uiActionsEnhanced.registerDrilldown(new url_drilldown_UrlDrilldown({getGlobalScope:Object(public_["urlDrilldownGlobalScopeProvider"])({core:core}),navigateToUrl:function navigateToUrl(url){return core.getStartServices().then((function(_ref){var _ref2=plugin_slicedToArray(_ref,1),application=_ref2[0].application;return application.navigateToUrl(url)}))},getSyntaxHelpDocsLink:function getSyntaxHelpDocsLink(){return startServices().core.docLinks.links.dashboard.urlDrilldownTemplateSyntax},getVariablesHelpDocsLink:function getVariablesHelpDocsLink(){return startServices().core.docLinks.links.dashboard.urlDrilldownVariables}}));return{}}},{key:"start",value:function start(core,plugins){return{}}},{key:"stop",value:function stop(){}}]);return UrlDrilldownPlugin}();function public_plugin(context){return new plugin_UrlDrilldownPlugin(context)}}]);