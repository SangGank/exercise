/*! Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one or more contributor license agreements.
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */(function(modules){function webpackJsonpCallback(data){var chunkIds=data[0];var moreModules=data[1];var moduleId,chunkId,i=0,resolves=[];for(;i<chunkIds.length;i++){chunkId=chunkIds[i];if(Object.prototype.hasOwnProperty.call(installedChunks,chunkId)&&installedChunks[chunkId]){resolves.push(installedChunks[chunkId][0])}installedChunks[chunkId]=0}for(moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){modules[moduleId]=moreModules[moduleId]}}if(parentJsonpFunction)parentJsonpFunction(data);while(resolves.length){resolves.shift()()}}var installedModules={};var installedChunks={0:0};function jsonpScriptSrc(chunkId){return __webpack_require__.p+"monitoring.chunk."+chunkId+".js"}function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.e=function requireEnsure(chunkId){var promises=[];var installedChunkData=installedChunks[chunkId];if(installedChunkData!==0){if(installedChunkData){promises.push(installedChunkData[2])}else{var promise=new Promise((function(resolve,reject){installedChunkData=installedChunks[chunkId]=[resolve,reject]}));promises.push(installedChunkData[2]=promise);var script=document.createElement("script");var onScriptComplete;script.charset="utf-8";script.timeout=120;if(__webpack_require__.nc){script.setAttribute("nonce",__webpack_require__.nc)}script.src=jsonpScriptSrc(chunkId);var error=new Error;onScriptComplete=function(event){script.onerror=script.onload=null;clearTimeout(timeout);var chunk=installedChunks[chunkId];if(chunk!==0){if(chunk){var errorType=event&&(event.type==="load"?"missing":event.type);var realSrc=event&&event.target&&event.target.src;error.message="Loading chunk "+chunkId+" failed.\n("+errorType+": "+realSrc+")";error.name="ChunkLoadError";error.type=errorType;error.request=realSrc;chunk[1](error)}installedChunks[chunkId]=undefined}};var timeout=setTimeout((function(){onScriptComplete({type:"timeout",target:script})}),12e4);script.onerror=script.onload=onScriptComplete;document.head.appendChild(script)}}return Promise.all(promises)};__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:true,get:getter})}};__webpack_require__.r=function(exports){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:true})};__webpack_require__.t=function(value,mode){if(mode&1)value=__webpack_require__(value);if(mode&8)return value;if(mode&4&&typeof value==="object"&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:true,value:value});if(mode&2&&typeof value!="string")for(var key in value)__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key));return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";__webpack_require__.oe=function(err){console.error(err);throw err};var jsonpArray=window["monitoring_bundle_jsonpfunction"]=window["monitoring_bundle_jsonpfunction"]||[];var oldJsonpFunction=jsonpArray.push.bind(jsonpArray);jsonpArray.push=webpackJsonpCallback;jsonpArray=jsonpArray.slice();for(var i=0;i<jsonpArray.length;i++)webpackJsonpCallback(jsonpArray[i]);var parentJsonpFunction=oldJsonpFunction;return __webpack_require__(__webpack_require__.s=11)})([function(module,exports){module.exports=__kbnSharedDeps__.KbnI18n},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"Q",(function(){return STORAGE_KEY}));__webpack_require__.d(__webpack_exports__,"O",(function(){return NORMALIZED_DERIVATIVE_UNIT}));__webpack_require__.d(__webpack_exports__,"B",(function(){return EUI_SORT_ASCENDING}));__webpack_require__.d(__webpack_exports__,"o",(function(){return CHART_LINE_COLOR}));__webpack_require__.d(__webpack_exports__,"p",(function(){return CHART_TEXT_COLOR}));__webpack_require__.d(__webpack_exports__,"C",(function(){return FORMAT_DURATION_TEMPLATE_LONG}));__webpack_require__.d(__webpack_exports__,"D",(function(){return FORMAT_DURATION_TEMPLATE_SHORT}));__webpack_require__.d(__webpack_exports__,"E",(function(){return FORMAT_DURATION_TEMPLATE_TINY}));__webpack_require__.d(__webpack_exports__,"m",(function(){return CALCULATE_DURATION_SINCE}));__webpack_require__.d(__webpack_exports__,"n",(function(){return CALCULATE_DURATION_UNTIL}));__webpack_require__.d(__webpack_exports__,"N",(function(){return ML_SUPPORTED_LICENSES}));__webpack_require__.d(__webpack_exports__,"L",(function(){return LOGSTASH}));__webpack_require__.d(__webpack_exports__,"z",(function(){return DEBOUNCE_SLOW_MS}));__webpack_require__.d(__webpack_exports__,"y",(function(){return DEBOUNCE_FAST_MS}));__webpack_require__.d(__webpack_exports__,"P",(function(){return STANDALONE_CLUSTER_CLUSTER_UUID}));__webpack_require__.d(__webpack_exports__,"G",(function(){return INDEX_PATTERN}));__webpack_require__.d(__webpack_exports__,"F",(function(){return INDEX_ALERTS}));__webpack_require__.d(__webpack_exports__,"H",(function(){return INDEX_PATTERN_ELASTICSEARCH}));__webpack_require__.d(__webpack_exports__,"A",(function(){return ELASTICSEARCH_SYSTEM_ID}));__webpack_require__.d(__webpack_exports__,"I",(function(){return INFRA_SOURCE_ID}));__webpack_require__.d(__webpack_exports__,"q",(function(){return CODE_PATH_ALL}));__webpack_require__.d(__webpack_exports__,"u",(function(){return CODE_PATH_KIBANA}));__webpack_require__.d(__webpack_exports__,"t",(function(){return CODE_PATH_ELASTICSEARCH}));__webpack_require__.d(__webpack_exports__,"x",(function(){return CODE_PATH_ML}));__webpack_require__.d(__webpack_exports__,"s",(function(){return CODE_PATH_BEATS}));__webpack_require__.d(__webpack_exports__,"w",(function(){return CODE_PATH_LOGSTASH}));__webpack_require__.d(__webpack_exports__,"r",(function(){return CODE_PATH_APM}));__webpack_require__.d(__webpack_exports__,"v",(function(){return CODE_PATH_LICENSE}));__webpack_require__.d(__webpack_exports__,"J",(function(){return KIBANA_SYSTEM_ID}));__webpack_require__.d(__webpack_exports__,"l",(function(){return BEATS_SYSTEM_ID}));__webpack_require__.d(__webpack_exports__,"k",(function(){return APM_SYSTEM_ID}));__webpack_require__.d(__webpack_exports__,"M",(function(){return LOGSTASH_SYSTEM_ID}));__webpack_require__.d(__webpack_exports__,"f",(function(){return ALERT_LICENSE_EXPIRATION}));__webpack_require__.d(__webpack_exports__,"a",(function(){return ALERT_CLUSTER_HEALTH}));__webpack_require__.d(__webpack_exports__,"b",(function(){return ALERT_CPU_USAGE}));__webpack_require__.d(__webpack_exports__,"c",(function(){return ALERT_DISK_USAGE}));__webpack_require__.d(__webpack_exports__,"j",(function(){return ALERT_NODES_CHANGED}));__webpack_require__.d(__webpack_exports__,"d",(function(){return ALERT_ELASTICSEARCH_VERSION_MISMATCH}));__webpack_require__.d(__webpack_exports__,"e",(function(){return ALERT_KIBANA_VERSION_MISMATCH}));__webpack_require__.d(__webpack_exports__,"g",(function(){return ALERT_LOGSTASH_VERSION_MISMATCH}));__webpack_require__.d(__webpack_exports__,"h",(function(){return ALERT_MEMORY_USAGE}));__webpack_require__.d(__webpack_exports__,"i",(function(){return ALERT_MISSING_MONITORING_DATA}));__webpack_require__.d(__webpack_exports__,"K",(function(){return LEGACY_ALERTS}));__webpack_require__.d(__webpack_exports__,"R",(function(){return TELEMETRY_METRIC_BUTTON_CLICK}));var LOGGING_TAG="monitoring";var KIBANA_MONITORING_LOGGING_TAG="kibana-monitoring";var MONITORING_SYSTEM_API_VERSION="7";var KIBANA_STATS_TYPE_MONITORING="kibana_stats";var KIBANA_SETTINGS_TYPE="kibana_settings";var STORAGE_KEY="xpack.monitoring.data";var NORMALIZED_DERIVATIVE_UNIT="1s";var EUI_SORT_ASCENDING="asc";var EUI_SORT_DESCENDING="desc";var SORT_ASCENDING=1;var SORT_DESCENDING=-1;var CHART_LINE_COLOR="#d2d2d2";var CHART_TEXT_COLOR="#9c9c9c";var CLUSTER_ALERTS_SEARCH_SIZE=3;var FORMAT_DURATION_TEMPLATE_LONG="M [months] d [days]";var FORMAT_DURATION_TEMPLATE_SHORT=" d [days] h [hrs] m [min]";var FORMAT_DURATION_TEMPLATE_TINY=" s [seconds]";var CALCULATE_DURATION_SINCE="since";var CALCULATE_DURATION_UNTIL="until";var ML_SUPPORTED_LICENSES=["trial","platinum","enterprise"];var CLOUD_METADATA_SERVICES={AWS_URL:"http://169.254.169.254/2016-09-02/dynamic/instance-identity/document",AZURE_URL:"http://169.254.169.254/metadata/instance?api-version=2017-04-02",GCP_URL_PREFIX:"http://169.254.169.254/computeMetadata/v1/instance"};var LOGSTASH={MAJOR_VER_REQD_FOR_PIPELINES:6,QUEUE_TYPES:{MEMORY:"memory",PERSISTED:"persisted"}};var DEBOUNCE_SLOW_MS=17;var DEBOUNCE_FAST_MS=10;var CLUSTER_ALERTS_ADDRESS_CONFIG_KEY="cluster_alerts.email_notifications.email_address";var STANDALONE_CLUSTER_CLUSTER_UUID="__standalone_cluster__";var INDEX_PATTERN=".monitoring-*-6-*,.monitoring-*-7-*";var INDEX_PATTERN_KIBANA=".monitoring-kibana-6-*,.monitoring-kibana-7-*";var INDEX_PATTERN_LOGSTASH=".monitoring-logstash-6-*,.monitoring-logstash-7-*";var INDEX_PATTERN_BEATS=".monitoring-beats-6-*,.monitoring-beats-7-*";var INDEX_ALERTS=".monitoring-alerts-6*,.monitoring-alerts-7*";var INDEX_PATTERN_ELASTICSEARCH=".monitoring-es-6-*,.monitoring-es-7-*";var METRICBEAT_INDEX_NAME_UNIQUE_TOKEN="-mb-";var ELASTICSEARCH_SYSTEM_ID="elasticsearch";var INFRA_SOURCE_ID="internal-stack-monitoring";var CODE_PATH_ALL="all";var CODE_PATH_ALERTS="alerts";var CODE_PATH_KIBANA="kibana";var CODE_PATH_ELASTICSEARCH="elasticsearch";var CODE_PATH_ML="ml";var CODE_PATH_BEATS="beats";var CODE_PATH_LOGSTASH="logstash";var CODE_PATH_APM="apm";var CODE_PATH_LICENSE="license";var CODE_PATH_LOGS="logs";var TELEMETRY_QUERY_SOURCE="TELEMETRY";var KIBANA_SYSTEM_ID="kibana";var BEATS_SYSTEM_ID="beats";var APM_SYSTEM_ID="apm";var LOGSTASH_SYSTEM_ID="logstash";var REPORTING_SYSTEM_ID="reporting";var TELEMETRY_COLLECTION_INTERVAL=864e5;var KIBANA_CLUSTER_ALERTS_ENABLED=false;var ALERT_PREFIX="monitoring_";var ALERT_LICENSE_EXPIRATION="".concat(ALERT_PREFIX,"alert_license_expiration");var ALERT_CLUSTER_HEALTH="".concat(ALERT_PREFIX,"alert_cluster_health");var ALERT_CPU_USAGE="".concat(ALERT_PREFIX,"alert_cpu_usage");var ALERT_DISK_USAGE="".concat(ALERT_PREFIX,"alert_disk_usage");var ALERT_NODES_CHANGED="".concat(ALERT_PREFIX,"alert_nodes_changed");var ALERT_ELASTICSEARCH_VERSION_MISMATCH="".concat(ALERT_PREFIX,"alert_elasticsearch_version_mismatch");var ALERT_KIBANA_VERSION_MISMATCH="".concat(ALERT_PREFIX,"alert_kibana_version_mismatch");var ALERT_LOGSTASH_VERSION_MISMATCH="".concat(ALERT_PREFIX,"alert_logstash_version_mismatch");var ALERT_MEMORY_USAGE="".concat(ALERT_PREFIX,"alert_jvm_memory_usage");var ALERT_MISSING_MONITORING_DATA="".concat(ALERT_PREFIX,"alert_missing_monitoring_data");var ALERTS=[ALERT_LICENSE_EXPIRATION,ALERT_CLUSTER_HEALTH,ALERT_CPU_USAGE,ALERT_DISK_USAGE,ALERT_NODES_CHANGED,ALERT_ELASTICSEARCH_VERSION_MISMATCH,ALERT_KIBANA_VERSION_MISMATCH,ALERT_LOGSTASH_VERSION_MISMATCH,ALERT_MEMORY_USAGE,ALERT_MISSING_MONITORING_DATA];var LEGACY_ALERTS=[ALERT_LICENSE_EXPIRATION,ALERT_CLUSTER_HEALTH,ALERT_NODES_CHANGED,ALERT_ELASTICSEARCH_VERSION_MISMATCH,ALERT_KIBANA_VERSION_MISMATCH,ALERT_LOGSTASH_VERSION_MISMATCH];var ALERT_ACTION_TYPE_EMAIL=".email";var ALERT_ACTION_TYPE_LOG=".server-log";var ALERT_EMAIL_SERVICES=["gmail","hotmail","icloud","outlook365","ses","yahoo"];var MONITORING_CONFIG_ALERTING_EMAIL_ADDRESS="monitoring:alertingEmailAddress";var XPACK_DEFAULT_ADMIN_EMAIL_UI_SETTING="xPack:defaultAdminEmail";var SAVED_OBJECT_TELEMETRY="monitoring-telemetry";var TELEMETRY_METRIC_BUTTON_CLICK="btnclick__"},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",(function(){return AlertClusterHealthType}));__webpack_require__.d(__webpack_exports__,"d",(function(){return AlertSeverity}));__webpack_require__.d(__webpack_exports__,"b",(function(){return AlertMessageTokenType}));__webpack_require__.d(__webpack_exports__,"c",(function(){return AlertParamType}));__webpack_require__.d(__webpack_exports__,"e",(function(){return SetupModeFeature}));var AlertClusterHealthType;(function(AlertClusterHealthType){AlertClusterHealthType["Green"]="green";AlertClusterHealthType["Red"]="red";AlertClusterHealthType["Yellow"]="yellow"})(AlertClusterHealthType||(AlertClusterHealthType={}));var AlertSeverity;(function(AlertSeverity){AlertSeverity["Success"]="success";AlertSeverity["Danger"]="danger";AlertSeverity["Warning"]="warning"})(AlertSeverity||(AlertSeverity={}));var AlertMessageTokenType;(function(AlertMessageTokenType){AlertMessageTokenType["Time"]="time";AlertMessageTokenType["Link"]="link";AlertMessageTokenType["DocLink"]="docLink"})(AlertMessageTokenType||(AlertMessageTokenType={}));var AlertParamType;(function(AlertParamType){AlertParamType["Duration"]="duration";AlertParamType["Percentage"]="percentage"})(AlertParamType||(AlertParamType={}));var SetupModeFeature;(function(SetupModeFeature){SetupModeFeature["MetricbeatMigration"]="metricbeatMigration";SetupModeFeature["Alerts"]="alerts"})(SetupModeFeature||(SetupModeFeature={}))},function(module,exports){module.exports=__kbnSharedDeps__.React},function(module,exports){module.exports=__kbnSharedDeps__.Lodash},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEui},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/alerts/common/parse_duration");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.Moment},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/data/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/home/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("entry/core/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var _node_modules_val_loader_dist_cjs_js_key_monitoring_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(12);var _node_modules_val_loader_dist_cjs_js_key_monitoring_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_val_loader_dist_cjs_js_key_monitoring_kbn_ui_shared_deps_public_path_module_creator_js__WEBPACK_IMPORTED_MODULE_0__);__kbnBundles__.define("plugin/monitoring/public",__webpack_require__,13)},function(module,exports,__webpack_require__){__webpack_require__.p=window.__kbnPublicPath__["monitoring"]},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__.d(__webpack_exports__,"plugin",(function(){return public_plugin}));var external_kbnSharedDeps_KbnI18n_=__webpack_require__(0);var public_=__webpack_require__(9);var data_public_=__webpack_require__(8);var core_public_=__webpack_require__(10);var external_kbnSharedDeps_React_=__webpack_require__(3);var external_kbnSharedDeps_React_default=__webpack_require__.n(external_kbnSharedDeps_React_);var constants=__webpack_require__(1);function validate(inputValues){var validationResult={errors:{}};var errors={duration:[],threshold:[]};if(!inputValues.duration){errors.duration.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.validation.duration",{defaultMessage:"A valid duration is required."}))}if(isNaN(inputValues.threshold)){errors.threshold.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.validation.threshold",{defaultMessage:"A valid number is required."}))}validationResult.errors=errors;return validationResult}var external_kbnSharedDeps_ElasticEui_=__webpack_require__(5);function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_unsupportedIterableToArray(arr,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}function _arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function _iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr}var TIME_UNITS;(function(TIME_UNITS){TIME_UNITS["SECOND"]="s";TIME_UNITS["MINUTE"]="m";TIME_UNITS["HOUR"]="h";TIME_UNITS["DAY"]="d"})(TIME_UNITS||(TIME_UNITS={}));function getTimeUnitLabel(){var timeUnit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:TIME_UNITS.SECOND;var timeValue=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"0";switch(timeUnit){case TIME_UNITS.SECOND:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.flyoutExpressions.timeUnits.secondLabel",{defaultMessage:"{timeValue, plural, one {second} other {seconds}}",values:{timeValue:timeValue}});case TIME_UNITS.MINUTE:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.flyoutExpressions.timeUnits.minuteLabel",{defaultMessage:"{timeValue, plural, one {minute} other {minutes}}",values:{timeValue:timeValue}});case TIME_UNITS.HOUR:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.flyoutExpressions.timeUnits.hourLabel",{defaultMessage:"{timeValue, plural, one {hour} other {hours}}",values:{timeValue:timeValue}});case TIME_UNITS.DAY:return external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.flyoutExpressions.timeUnits.dayLabel",{defaultMessage:"{timeValue, plural, one {day} other {days}}",values:{timeValue:timeValue}})}}var parseRegex=/(\d+)([smhd]{1})/;var alert_param_duration_AlertParamDuration=function AlertParamDuration(props){var name=props.name,label=props.label,setAlertParams=props.setAlertParams,errors=props.errors;var parsed=parseRegex.exec(props.duration);var defaultValue=parsed&&parsed[1]?parseInt(parsed[1],10):1;var defaultUnit=parsed&&parsed[2]?parsed[2]:TIME_UNITS.MINUTE;var _React$useState=external_kbnSharedDeps_React_default.a.useState(defaultValue),_React$useState2=_slicedToArray(_React$useState,2),value=_React$useState2[0],setValue=_React$useState2[1];var _React$useState3=external_kbnSharedDeps_React_default.a.useState(defaultUnit),_React$useState4=_slicedToArray(_React$useState3,2),unit=_React$useState4[0],setUnit=_React$useState4[1];var timeUnits=Object.values(TIME_UNITS).map((function(timeUnit){return{value:timeUnit,text:getTimeUnitLabel(timeUnit)}}));external_kbnSharedDeps_React_default.a.useEffect((function(){setAlertParams(name,"".concat(value).concat(unit))}),[unit,value]);return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:label,error:errors,isInvalid:errors.length>0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexGroup"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:2},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{compressed:true,value:value,onChange:function onChange(e){var newValue=parseInt(e.target.value,10);if(isNaN(newValue)){newValue=0}setValue(newValue)}})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFlexItem"],{grow:4},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSelect"],{compressed:true,value:unit,onChange:function onChange(e){return setUnit(e.target.value)},options:timeUnits}))))};var enums=__webpack_require__(2);function alert_param_percentage_slicedToArray(arr,i){return alert_param_percentage_arrayWithHoles(arr)||alert_param_percentage_iterableToArrayLimit(arr,i)||alert_param_percentage_unsupportedIterableToArray(arr,i)||alert_param_percentage_nonIterableRest()}function alert_param_percentage_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function alert_param_percentage_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return alert_param_percentage_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return alert_param_percentage_arrayLikeToArray(o,minLen)}function alert_param_percentage_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function alert_param_percentage_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function alert_param_percentage_arrayWithHoles(arr){if(Array.isArray(arr))return arr}var alert_param_percentage_AlertParamPercentage=function AlertParamPercentage(props){var name=props.name,label=props.label,setAlertParams=props.setAlertParams,errors=props.errors;var _React$useState=external_kbnSharedDeps_React_default.a.useState(props.percentage),_React$useState2=alert_param_percentage_slicedToArray(_React$useState,2),value=_React$useState2[0],setValue=_React$useState2[1];return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFormRow"],{label:label,error:errors,isInvalid:errors.length>0},external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiFieldNumber"],{compressed:true,value:value,append:external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiText"],{size:"xs"},external_kbnSharedDeps_React_default.a.createElement("strong",null,"%")),onChange:function onChange(e){var newValue=parseInt(e.target.value,10);if(isNaN(newValue)){newValue=0}setValue(newValue);setAlertParams(name,newValue)}}))};var expression_Expression=function Expression(props){var alertParams=props.alertParams,paramDetails=props.paramDetails,setAlertParams=props.setAlertParams,errors=props.errors;var alertParamsUi=Object.keys(alertParams).map((function(alertParamName){var details=paramDetails[alertParamName];var value=alertParams[alertParamName];switch(details.type){case enums["c"].Duration:return external_kbnSharedDeps_React_default.a.createElement(alert_param_duration_AlertParamDuration,{key:alertParamName,name:alertParamName,duration:value,label:details.label,errors:errors[alertParamName],setAlertParams:setAlertParams});case enums["c"].Percentage:return external_kbnSharedDeps_React_default.a.createElement(alert_param_percentage_AlertParamPercentage,{key:alertParamName,name:alertParamName,label:details.label,percentage:value,errors:errors[alertParamName],setAlertParams:setAlertParams})}}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{component:"form"},alertParamsUi),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))};function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchAvailableCcs(_x){return _fetchAvailableCcs.apply(this,arguments)}function _fetchAvailableCcs(){_fetchAvailableCcs=_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster){var availableCcs,response,remoteName,remoteInfo;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:availableCcs=[];_context.next=3;return callCluster("cluster.remoteInfo");case 3:response=_context.sent;_context.t0=regeneratorRuntime.keys(response);case 5:if((_context.t1=_context.t0()).done){_context.next=13;break}remoteName=_context.t1.value;if(response.hasOwnProperty(remoteName)){_context.next=9;break}return _context.abrupt("continue",5);case 9:remoteInfo=response[remoteName];if(remoteInfo.connected){availableCcs.push(remoteName)}_context.next=5;break;case 13:return _context.abrupt("return",availableCcs);case 14:case"end":return _context.stop()}}}),_callee)})));return _fetchAvailableCcs.apply(this,arguments)}var external_kbnSharedDeps_Lodash_=__webpack_require__(4);function fetch_clusters_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_clusters_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_clusters_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_clusters_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetch_clusters_fetchClusters(_x,_x2){return _fetchClusters.apply(this,arguments)}function _fetchClusters(){_fetchClusters=fetch_clusters_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,index){var rangeFilter,params,response,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:rangeFilter=_args.length>2&&_args[2]!==undefined?_args[2]:{timestamp:{gte:"now-2m"}};params={index:index,filterPath:["hits.hits._source.cluster_settings.cluster.metadata.display_name","hits.hits._source.cluster_uuid","hits.hits._source.cluster_name"],body:{size:1e3,query:{bool:{filter:[{term:{type:"cluster_stats"}},{range:rangeFilter}]}},collapse:{field:"cluster_uuid"}}};_context.next=4;return callCluster("search",params);case 4:response=_context.sent;return _context.abrupt("return",Object(external_kbnSharedDeps_Lodash_["get"])(response,"hits.hits",[]).map((function(hit){var clusterName=Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.cluster_settings.cluster.metadata.display_name")||Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.cluster_name")||Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.cluster_uuid");return{clusterUuid:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.cluster_uuid"),clusterName:clusterName}})));case 6:case"end":return _context.stop()}}}),_callee)})));return _fetchClusters.apply(this,arguments)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||get_ccs_index_pattern_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return get_ccs_index_pattern_arrayLikeToArray(arr)}function _createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=get_ccs_index_pattern_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function get_ccs_index_pattern_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return get_ccs_index_pattern_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return get_ccs_index_pattern_arrayLikeToArray(o,minLen)}function get_ccs_index_pattern_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function getCcsIndexPattern(indexPattern,remotes){if(remotes.length===0){return indexPattern}var patternsToAdd=[];var _iterator=_createForOfIteratorHelper(indexPattern.split(",")),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var index=_step.value;var _iterator2=_createForOfIteratorHelper(remotes),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var remote=_step2.value;patternsToAdd.push("".concat(remote,":").concat(index))}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return[].concat(_toConsumableArray(indexPattern.split(",")),patternsToAdd).join(",")}function mb_safe_query_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function mb_safe_query_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){mb_safe_query_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){mb_safe_query_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}var mbSafeQuery=function(){var _ref=mb_safe_query_asyncToGenerator(regeneratorRuntime.mark((function _callee(queryExecutor){return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return queryExecutor();case 3:return _context.abrupt("return",_context.sent);case 6:_context.prev=6;_context.t0=_context["catch"](0);if(!(_context.t0.message.includes("no mapping found for")&&_context.t0.message.includes("in order to collapse on"))){_context.next=10;break}return _context.abrupt("return",{});case 10:throw _context.t0;case 11:case"end":return _context.stop()}}}),_callee,null,[[0,6]])})));return function mbSafeQuery(_x){return _ref.apply(this,arguments)}}();function appendMetricbeatIndex(config,indexPattern){return"".concat(indexPattern,",").concat(config.ui.metricbeat.index)}function base_alert_toConsumableArray(arr){return base_alert_arrayWithoutHoles(arr)||base_alert_iterableToArray(arr)||base_alert_unsupportedIterableToArray(arr)||base_alert_nonIterableSpread()}function base_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function base_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function base_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return base_alert_arrayLikeToArray(arr)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach((function(key){_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function base_alert_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=base_alert_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function base_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return base_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return base_alert_arrayLikeToArray(o,minLen)}function base_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function base_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function base_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){base_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){base_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var base_alert_BaseAlert=function(){_createClass(BaseAlert,[{key:"paramDetails",get:function get(){return{}}}]);function BaseAlert(){var rawAlert=arguments.length>0&&arguments[0]!==undefined?arguments[0]:undefined;_classCallCheck(this,BaseAlert);_defineProperty(this,"type",void 0);_defineProperty(this,"label",void 0);_defineProperty(this,"defaultThrottle","1d");_defineProperty(this,"defaultInterval","1m");_defineProperty(this,"rawAlert",void 0);_defineProperty(this,"isLegacy",false);_defineProperty(this,"getUiSettingsService",void 0);_defineProperty(this,"monitoringCluster",void 0);_defineProperty(this,"getLogger",void 0);_defineProperty(this,"config",void 0);_defineProperty(this,"kibanaUrl",void 0);_defineProperty(this,"isCloud",false);_defineProperty(this,"defaultParams",{});_defineProperty(this,"actionVariables",[]);_defineProperty(this,"alertType",void 0);if(rawAlert){this.rawAlert=rawAlert}}_createClass(BaseAlert,[{key:"serialize",value:function serialize(){if(!this.rawAlert){return null}return{type:this.type,label:this.label,rawAlert:this.rawAlert,paramDetails:this.paramDetails,isLegacy:this.isLegacy}}},{key:"initializeAlertType",value:function initializeAlertType(getUiSettingsService,monitoringCluster,getLogger,config,kibanaUrl,isCloud){this.getUiSettingsService=getUiSettingsService;this.monitoringCluster=monitoringCluster;this.config=config;this.kibanaUrl=kibanaUrl;this.getLogger=getLogger;this.isCloud=isCloud}},{key:"getAlertType",value:function getAlertType(){var _this=this;return{id:this.type,name:this.label,actionGroups:[{id:"default",name:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionGroups.default",{defaultMessage:"Default"})}],defaultActionGroupId:"default",executor:function executor(options){return _this.execute(options)},producer:"monitoring",actionVariables:{context:this.actionVariables}}}},{key:"isEnabled",value:function isEnabled(licenseService){if(this.isLegacy){var watcherFeature=licenseService.getWatcherFeature();if(!watcherFeature.isAvailable||!watcherFeature.isEnabled){return false}}return true}},{key:"getId",value:function getId(){return this.rawAlert?this.rawAlert.id:null}},{key:"createIfDoesNotExist",value:function(){var _createIfDoesNotExist=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(alertsClient,actionsClient,actions){var existingAlertData,existingAlert,alertActions,_iterator,_step,actionData,action;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return alertsClient.find({options:{search:this.type}});case 2:existingAlertData=_context.sent;if(!(existingAlertData.total>0)){_context.next=6;break}existingAlert=existingAlertData.data[0];return _context.abrupt("return",existingAlert);case 6:alertActions=[];_iterator=base_alert_createForOfIteratorHelper(actions);_context.prev=8;_iterator.s();case 10:if((_step=_iterator.n()).done){_context.next=20;break}actionData=_step.value;_context.next=14;return actionsClient.get({id:actionData.id});case 14:action=_context.sent;if(action){_context.next=17;break}return _context.abrupt("continue",18);case 17:alertActions.push({group:"default",id:actionData.id,params:_objectSpread({message:this.getDefaultActionMessage(true)},actionData.config)});case 18:_context.next=10;break;case 20:_context.next=25;break;case 22:_context.prev=22;_context.t0=_context["catch"](8);_iterator.e(_context.t0);case 25:_context.prev=25;_iterator.f();return _context.finish(25);case 28:_context.next=30;return alertsClient.create({data:{enabled:true,tags:[],params:this.defaultParams,consumer:"monitoring",name:this.label,alertTypeId:this.type,throttle:this.defaultThrottle,schedule:{interval:this.defaultInterval},actions:alertActions}});case 30:return _context.abrupt("return",_context.sent);case 31:case"end":return _context.stop()}}}),_callee,this,[[8,22,25,28]])})));function createIfDoesNotExist(_x,_x2,_x3){return _createIfDoesNotExist.apply(this,arguments)}return createIfDoesNotExist}()},{key:"getStates",value:function(){var _getStates=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(alertsClient,id,filters){var _this2=this;var states;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return alertsClient.getAlertState({id:id});case 2:states=_context2.sent;if(!(!states||!states.alertInstances)){_context2.next=5;break}return _context2.abrupt("return",{});case 5:return _context2.abrupt("return",Object.keys(states.alertInstances).reduce((function(accum,instanceId){if(!states.alertInstances){return accum}var alertInstance=states.alertInstances[instanceId];if(alertInstance&&_this2.filterAlertInstance(alertInstance,filters)){accum[instanceId]=alertInstance;if(alertInstance.state){accum[instanceId].state={alertStates:alertInstance.state.alertStates.filter((function(alertState){return _this2.filterAlertState(alertState,filters)}))}}}return accum}),{}));case 6:case"end":return _context2.stop()}}}),_callee2)})));function getStates(_x4,_x5,_x6){return _getStates.apply(this,arguments)}return getStates}()},{key:"filterAlertInstance",value:function filterAlertInstance(alertInstance,filters){return true}},{key:"filterAlertState",value:function filterAlertState(alertState,filters){return true}},{key:"execute",value:function(){var _execute=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee5(_ref){var services,params,state,logger,_callCluster,callCluster,availableCcs,clusters,uiSettings,data;return regeneratorRuntime.wrap((function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:services=_ref.services,params=_ref.params,state=_ref.state;logger=this.getLogger(this.type);logger.debug("Executing alert with params: ".concat(JSON.stringify(params)," and state: ").concat(JSON.stringify(state)));_callCluster=this.monitoringCluster?this.monitoringCluster.callAsInternalUser:services.callCluster;callCluster=function(){var _ref2=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee4(endpoint,clientParams,options){return regeneratorRuntime.wrap((function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return mbSafeQuery(base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee3(){return regeneratorRuntime.wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt("return",_callCluster(endpoint,clientParams,options));case 1:case"end":return _context3.stop()}}}),_callee3)}))));case 2:return _context4.abrupt("return",_context4.sent);case 3:case"end":return _context4.stop()}}}),_callee4)})));return function callCluster(_x8,_x9,_x10){return _ref2.apply(this,arguments)}}();if(!this.config.ui.ccs.enabled){_context5.next=11;break}_context5.next=8;return fetchAvailableCcs(callCluster);case 8:_context5.t0=_context5.sent;_context5.next=12;break;case 11:_context5.t0=[];case 12:availableCcs=_context5.t0;_context5.next=15;return this.fetchClusters(callCluster,availableCcs,params);case 15:clusters=_context5.sent;_context5.next=18;return this.getUiSettingsService();case 18:uiSettings=_context5.sent.asScopedToClient(services.savedObjectsClient);_context5.next=21;return this.fetchData(params,callCluster,clusters,uiSettings,availableCcs);case 21:data=_context5.sent;_context5.next=24;return this.processData(data,clusters,services,logger,state);case 24:return _context5.abrupt("return",_context5.sent);case 25:case"end":return _context5.stop()}}}),_callee5,this)})));function execute(_x7){return _execute.apply(this,arguments)}return execute}()},{key:"fetchClusters",value:function(){var _fetchClusters2=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee6(callCluster){var availableCcs,params,ccs,esIndexPattern,_args6=arguments;return regeneratorRuntime.wrap((function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:availableCcs=_args6.length>1&&_args6[1]!==undefined?_args6[1]:undefined;params=_args6.length>2?_args6[2]:undefined;if(availableCcs){_context6.next=13;break}if(!this.config.ui.ccs.enabled){_context6.next=9;break}_context6.next=6;return fetchAvailableCcs(callCluster);case 6:_context6.t0=_context6.sent;_context6.next=10;break;case 9:_context6.t0=undefined;case 10:ccs=_context6.t0;_context6.next=14;break;case 13:ccs=availableCcs;case 14:esIndexPattern=appendMetricbeatIndex(this.config,constants["H"]);if(ccs){esIndexPattern=getCcsIndexPattern(esIndexPattern,ccs)}_context6.next=18;return fetch_clusters_fetchClusters(callCluster,esIndexPattern);case 18:return _context6.abrupt("return",_context6.sent);case 19:case"end":return _context6.stop()}}}),_callee6,this)})));function fetchClusters(_x11){return _fetchClusters2.apply(this,arguments)}return fetchClusters}()},{key:"fetchData",value:function(){var _fetchData=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee7(params,callCluster,clusters,uiSettings,availableCcs){return regeneratorRuntime.wrap((function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:throw new Error("Child classes must implement `fetchData`");case 1:case"end":return _context7.stop()}}}),_callee7)})));function fetchData(_x12,_x13,_x14,_x15,_x16){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"processData",value:function(){var _processData=base_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee8(data,clusters,services,logger,instanceState){var _this3=this;var _iterator2,_step2,_loop,_ret;return regeneratorRuntime.wrap((function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_iterator2=base_alert_createForOfIteratorHelper(data);_context8.prev=1;_loop=function _loop(){var item=_step2.value;var cluster=clusters.find((function(c){return c.clusterUuid===item.clusterUuid}));if(!cluster){logger.warn("Unable to find cluster for clusterUuid='".concat(item.clusterUuid,"'"));return"continue"}var instance=services.alertInstanceFactory("".concat(_this3.type,":").concat(item.instanceKey));var state=instance.getState();var alertInstanceState={alertStates:(state===null||state===void 0?void 0:state.alertStates)||[]};var alertState=void 0;var indexInState=_this3.findIndexInInstanceState(alertInstanceState,cluster);if(indexInState>-1){alertState=state.alertStates[indexInState]}else{alertState=_this3.getDefaultAlertState(cluster,item)}var shouldExecuteActions=false;if(item.shouldFire){logger.debug("".concat(_this3.type," is firing"));alertState.ui.triggeredMS=+new Date;alertState.ui.isFiring=true;alertState.ui.message=_this3.getUiMessage(alertState,item);alertState.ui.severity=item.severity;alertState.ui.resolvedMS=0;shouldExecuteActions=true}else if(!item.shouldFire&&alertState.ui.isFiring){logger.debug("".concat(_this3.type," is not firing anymore"));alertState.ui.isFiring=false;alertState.ui.resolvedMS=+new Date;alertState.ui.message=_this3.getUiMessage(alertState,item);shouldExecuteActions=true}if(indexInState===-1){alertInstanceState.alertStates.push(alertState)}else{alertInstanceState.alertStates=[].concat(base_alert_toConsumableArray(alertInstanceState.alertStates.slice(0,indexInState)),[alertState],base_alert_toConsumableArray(alertInstanceState.alertStates.slice(indexInState+1)))}instance.replaceState(alertInstanceState);if(shouldExecuteActions){_this3.executeActions(instance,alertInstanceState,item,cluster)}};_iterator2.s();case 4:if((_step2=_iterator2.n()).done){_context8.next=10;break}_ret=_loop();if(!(_ret==="continue")){_context8.next=8;break}return _context8.abrupt("continue",8);case 8:_context8.next=4;break;case 10:_context8.next=15;break;case 12:_context8.prev=12;_context8.t0=_context8["catch"](1);_iterator2.e(_context8.t0);case 15:_context8.prev=15;_iterator2.f();return _context8.finish(15);case 18:case"end":return _context8.stop()}}}),_callee8,null,[[1,12,15,18]])})));function processData(_x17,_x18,_x19,_x20,_x21){return _processData.apply(this,arguments)}return processData}()},{key:"getDefaultActionMessage",value:function getDefaultActionMessage(forDefaultServerLog){return forDefaultServerLog?"{{context.internalShortMessage}}":"{{context.internalFullMessage}}"}},{key:"findIndexInInstanceState",value:function findIndexInInstanceState(stateInstance,cluster){return stateInstance.alertStates.findIndex((function(alertState){return alertState.cluster.clusterUuid===cluster.clusterUuid}))}},{key:"getDefaultAlertState",value:function getDefaultAlertState(cluster,item){return{cluster:cluster,ccs:item.ccs,ui:{isFiring:false,message:null,severity:enums["d"].Success,resolvedMS:0,triggeredMS:0,lastCheckedMS:0}}}},{key:"getUiMessage",value:function getUiMessage(alertState,item){throw new Error("Child classes must implement `getUiMessage`")}},{key:"executeActions",value:function executeActions(instance,instanceState,item,cluster){throw new Error("Child classes must implement `executeActions`")}},{key:"createGlobalStateLink",value:function createGlobalStateLink(link,clusterUuid,ccs){var globalState=["cluster_uuid:".concat(clusterUuid)];if(ccs){globalState.push("ccs:".concat(ccs))}return"".concat(this.kibanaUrl,"/app/monitoring#/").concat(link,"?_g=(").concat(globalState.toString(),")")}}]);return BaseAlert}();var external_kbnSharedDeps_Moment_=__webpack_require__(7);var external_kbnSharedDeps_Moment_default=__webpack_require__.n(external_kbnSharedDeps_Moment_);function fetch_cpu_usage_node_stats_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=fetch_cpu_usage_node_stats_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function fetch_cpu_usage_node_stats_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return fetch_cpu_usage_node_stats_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fetch_cpu_usage_node_stats_arrayLikeToArray(o,minLen)}function fetch_cpu_usage_node_stats_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function fetch_cpu_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_cpu_usage_node_stats_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_cpu_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_cpu_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchCpuUsageNodeStats(_x,_x2,_x3,_x4,_x5,_x6){return _fetchCpuUsageNodeStats.apply(this,arguments)}function _fetchCpuUsageNodeStats(){_fetchCpuUsageNodeStats=fetch_cpu_usage_node_stats_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,clusters,index,startMs,endMs,size){var intervalInMinutes,filterPath,params,response,stats,clusterBuckets,_iterator,_step,clusterBucket,_iterator2,_step2,node,lastBucket,indexName,stat;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:intervalInMinutes=external_kbnSharedDeps_Moment_default.a.duration(endMs-startMs).asMinutes();filterPath=["aggregations"];params={index:index,filterPath:filterPath,body:{size:0,query:{bool:{filter:[{terms:{cluster_uuid:clusters.map((function(cluster){return cluster.clusterUuid}))}},{term:{type:"node_stats"}},{range:{timestamp:{format:"epoch_millis",gte:startMs,lte:endMs}}}]}},aggs:{clusters:{terms:{field:"cluster_uuid",size:size,include:clusters.map((function(cluster){return cluster.clusterUuid}))},aggs:{nodes:{terms:{field:"node_stats.node_id",size:size},aggs:{index:{terms:{field:"_index",size:1}},average_cpu:{avg:{field:"node_stats.process.cpu.percent"}},average_quota:{avg:{field:"node_stats.os.cgroup.cpu.cfs_quota_micros"}},name:{terms:{field:"source_node.name",size:1}},histo:{date_histogram:{field:"timestamp",fixed_interval:"".concat(intervalInMinutes,"m")},aggs:{average_periods:{max:{field:"node_stats.os.cgroup.cpu.stat.number_of_elapsed_periods"}},average_usage:{max:{field:"node_stats.os.cgroup.cpuacct.usage_nanos"}},usage_deriv:{derivative:{buckets_path:"average_usage",gap_policy:"skip",unit:constants["O"]}},periods_deriv:{derivative:{buckets_path:"average_periods",gap_policy:"skip",unit:constants["O"]}}}}}}}}}}};_context.next=5;return callCluster("search",params);case 5:response=_context.sent;stats=[];clusterBuckets=Object(external_kbnSharedDeps_Lodash_["get"])(response,"aggregations.clusters.buckets",[]);_iterator=fetch_cpu_usage_node_stats_createForOfIteratorHelper(clusterBuckets);try{for(_iterator.s();!(_step=_iterator.n()).done;){clusterBucket=_step.value;_iterator2=fetch_cpu_usage_node_stats_createForOfIteratorHelper(clusterBucket.nodes.buckets);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){node=_step2.value;lastBucket=Object(external_kbnSharedDeps_Lodash_["get"])(node,"histo.buckets[1]",{});indexName=Object(external_kbnSharedDeps_Lodash_["get"])(node,"index.buckets[0].key","");stat={clusterUuid:clusterBucket.key,nodeId:node.key,nodeName:Object(external_kbnSharedDeps_Lodash_["get"])(node,"name.buckets[0].key"),cpuUsage:Object(external_kbnSharedDeps_Lodash_["get"])(node,"average_cpu.value"),containerUsage:Object(external_kbnSharedDeps_Lodash_["get"])(lastBucket,"usage_deriv.normalized_value"),containerPeriods:Object(external_kbnSharedDeps_Lodash_["get"])(lastBucket,"periods_deriv.normalized_value"),containerQuota:Object(external_kbnSharedDeps_Lodash_["get"])(node,"average_quota.value"),ccs:indexName.includes(":")?indexName.split(":")[0]:null};stats.push(stat)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}}}catch(err){_iterator.e(err)}finally{_iterator.f()}return _context.abrupt("return",stats);case 11:case"end":return _context.stop()}}}),_callee)})));return _fetchCpuUsageNodeStats.apply(this,arguments)}var parse_duration_=__webpack_require__(6);function alerts_common_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function alerts_common_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){alerts_common_ownKeys(Object(source),true).forEach((function(key){alerts_common_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{alerts_common_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function alerts_common_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function alerts_common_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var AlertingDefaults=function AlertingDefaults(){alerts_common_classCallCheck(this,AlertingDefaults)};alerts_common_defineProperty(AlertingDefaults,"ALERT_STATE",{resolved:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.state.resolved",{defaultMessage:"resolved"}),firing:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.state.firing",{defaultMessage:"firing"})});alerts_common_defineProperty(AlertingDefaults,"ALERT_TYPE",{context:{internalShortMessage:{name:"internalShortMessage",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.internalShortMessage",{defaultMessage:"The short internal message generated by Elastic."})},internalFullMessage:{name:"internalFullMessage",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.internalFullMessage",{defaultMessage:"The full internal message generated by Elastic."})},state:{name:"state",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.state",{defaultMessage:"The current state of the alert."})},clusterName:{name:"clusterName",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.clusterName",{defaultMessage:"The cluster to which the nodes belong."})},action:{name:"action",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.action",{defaultMessage:"The recommended action for this alert."})},actionPlain:{name:"actionPlain",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.actionVariables.actionPlain",{defaultMessage:"The recommended action for this alert, without any markdown."})}}});var alerts_common_createLink=function createLink(linkText,linkURL){var type=arguments.length>2&&arguments[2]!==undefined?arguments[2]:enums["b"].DocLink;var link=type===enums["b"].DocLink?{partialUrl:linkURL}:{url:linkURL};return{text:linkText,tokens:[alerts_common_objectSpread(alerts_common_objectSpread({},link),{},{startToken:"#start_link",endToken:"#end_link",type:type})]}};function cpu_usage_alert_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function cpu_usage_alert_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){cpu_usage_alert_ownKeys(Object(source),true).forEach((function(key){cpu_usage_alert_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{cpu_usage_alert_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function cpu_usage_alert_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=cpu_usage_alert_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function cpu_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function cpu_usage_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){cpu_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){cpu_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function cpu_usage_alert_toConsumableArray(arr){return cpu_usage_alert_arrayWithoutHoles(arr)||cpu_usage_alert_iterableToArray(arr)||cpu_usage_alert_unsupportedIterableToArray(arr)||cpu_usage_alert_nonIterableSpread()}function cpu_usage_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function cpu_usage_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return cpu_usage_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cpu_usage_alert_arrayLikeToArray(o,minLen)}function cpu_usage_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function cpu_usage_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return cpu_usage_alert_arrayLikeToArray(arr)}function cpu_usage_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function cpu_usage_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function cpu_usage_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function cpu_usage_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)cpu_usage_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)cpu_usage_alert_defineProperties(Constructor,staticProps);return Constructor}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break}return object}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function cpu_usage_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var DEFAULT_THRESHOLD=85;var DEFAULT_DURATION="5m";var cpu_usage_alert_CpuUsageAlert=function(_BaseAlert){_inherits(CpuUsageAlert,_BaseAlert);var _super=_createSuper(CpuUsageAlert);function CpuUsageAlert(){var _this;cpu_usage_alert_classCallCheck(this,CpuUsageAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));cpu_usage_alert_defineProperty(_assertThisInitialized(_this),"type",constants["b"]);cpu_usage_alert_defineProperty(_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.label",{defaultMessage:"CPU Usage"}));cpu_usage_alert_defineProperty(_assertThisInitialized(_this),"defaultParams",{threshold:DEFAULT_THRESHOLD,duration:DEFAULT_DURATION});cpu_usage_alert_defineProperty(_assertThisInitialized(_this),"actionVariables",[{name:"nodes",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.actionVariables.nodes",{defaultMessage:"The list of nodes reporting high cpu usage."})},{name:"count",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.actionVariables.count",{defaultMessage:"The number of nodes reporting high cpu usage."})}].concat(cpu_usage_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}cpu_usage_alert_createClass(CpuUsageAlert,[{key:"fetchData",value:function(){var _fetchData=cpu_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var _this2=this;var esIndexPattern,duration,endMs,startMs,stats;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:esIndexPattern=appendMetricbeatIndex(this.config,constants["H"]);if(availableCcs){esIndexPattern=getCcsIndexPattern(esIndexPattern,availableCcs)}duration=Object(parse_duration_["parseDuration"])(params.duration);endMs=+new Date;startMs=endMs-duration;_context.next=7;return fetchCpuUsageNodeStats(callCluster,clusters,esIndexPattern,startMs,endMs,this.config.ui.max_bucket_size);case 7:stats=_context.sent;return _context.abrupt("return",stats.map((function(stat){if(_this2.config.ui.container.elasticsearch.enabled){stat.cpuUsage=stat.containerUsage/(stat.containerPeriods*stat.containerQuota*1e3)*100}return{instanceKey:"".concat(stat.clusterUuid,":").concat(stat.nodeId),clusterUuid:stat.clusterUuid,shouldFire:stat.cpuUsage>params.threshold,severity:enums["d"].Danger,meta:stat,ccs:stat.ccs}})));case 9:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"filterAlertInstance",value:function filterAlertInstance(alertInstance,filters){var alertInstanceState=alertInstance.state;if(filters&&filters.length){var _iterator=cpu_usage_alert_createForOfIteratorHelper(filters),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _filter=_step.value;var filter=_filter;if(filter&&filter.nodeUuid){var nodeExistsInStates=false;var _iterator2=cpu_usage_alert_createForOfIteratorHelper(alertInstanceState.alertStates),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var state=_step2.value;if(state.nodeId===filter.nodeUuid){nodeExistsInStates=true;break}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}if(!nodeExistsInStates){return false}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return true}},{key:"getDefaultAlertState",value:function getDefaultAlertState(cluster,item){var base=_get(_getPrototypeOf(CpuUsageAlert.prototype),"getDefaultAlertState",this).call(this,cluster,item);return cpu_usage_alert_objectSpread(cpu_usage_alert_objectSpread({},base),{},{ui:cpu_usage_alert_objectSpread(cpu_usage_alert_objectSpread({},base.ui),{},{severity:enums["d"].Danger})})}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var stat=item.meta;if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.ui.resolvedMessage",{defaultMessage:"The cpu usage on node {nodeName} is now under the threshold, currently reporting at {cpuUsage}% as of #resolved",values:{nodeName:stat.nodeName,cpuUsage:stat.cpuUsage.toFixed(2)}}),tokens:[{startToken:"#resolved",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.resolvedMS}]}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.ui.firingMessage",{defaultMessage:"Node #start_link{nodeName}#end_link is reporting cpu usage of {cpuUsage}% at #absolute",values:{nodeName:stat.nodeName,cpuUsage:stat.cpuUsage.toFixed(2)}}),nextSteps:[alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.ui.nextSteps.hotThreads",{defaultMessage:"#start_linkCheck hot threads#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/cluster-nodes-hot-threads.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.ui.nextSteps.runningTasks",{defaultMessage:"#start_linkCheck long running tasks#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/tasks.html")],tokens:[{startToken:"#absolute",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.triggeredMS},{startToken:"#start_link",endToken:"#end_link",type:enums["b"].Link,url:"elasticsearch/nodes/".concat(stat.nodeId)}]}}},{key:"executeActions",value:function executeActions(instance,instanceState,item,cluster){if(instanceState.alertStates.length===0){return}var firingCount=instanceState.alertStates.filter((function(alertState){return alertState.ui.isFiring})).length;var firingNodes=instanceState.alertStates.filter((function(_state){return _state.ui.isFiring})).map((function(_state){var state=_state;return"".concat(state.nodeName,":").concat(state.cpuUsage.toFixed(2))})).join(",");if(firingCount>0){var shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.shortAction",{defaultMessage:"Verify CPU levels across affected nodes."});var fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.fullAction",{defaultMessage:"View nodes"});var action="[".concat(fullActionText,"](elasticsearch/nodes)");var internalShortMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.firing.internalShortMessage",{defaultMessage:"CPU usage alert is firing for {count} node(s) in cluster: {clusterName}. {shortActionText}",values:{count:firingCount,clusterName:cluster.clusterName,shortActionText:shortActionText}});var internalFullMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.firing.internalFullMessage",{defaultMessage:"CPU usage alert is firing for {count} node(s) in cluster: {clusterName}. {action}",values:{count:firingCount,clusterName:cluster.clusterName,action:action}});instance.scheduleActions("default",{internalShortMessage:internalShortMessage,internalFullMessage:this.isCloud?internalShortMessage:internalFullMessage,state:AlertingDefaults.ALERT_STATE.firing,nodes:firingNodes,count:firingCount,clusterName:cluster.clusterName,action:action,actionPlain:shortActionText})}else{var resolvedCount=instanceState.alertStates.filter((function(alertState){return!alertState.ui.isFiring})).length;var resolvedNodes=instanceState.alertStates.filter((function(_state){return!_state.ui.isFiring})).map((function(_state){var state=_state;return"".concat(state.nodeName,":").concat(state.cpuUsage.toFixed(2))})).join(",");if(resolvedCount>0){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.resolved.internalShortMessage",{defaultMessage:"CPU usage alert is resolved for {count} node(s) in cluster: {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.resolved.internalFullMessage",{defaultMessage:"CPU usage alert is resolved for {count} node(s) in cluster: {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,nodes:resolvedNodes,count:resolvedCount,clusterName:cluster.clusterName})}}}},{key:"processData",value:function(){var _processData=cpu_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(data,clusters,services){var _this3=this;var _iterator3,_step3,_loop,_ret;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_iterator3=cpu_usage_alert_createForOfIteratorHelper(clusters);_context2.prev=1;_loop=function _loop(){var cluster=_step3.value;var nodes=data.filter((function(_item){return _item.clusterUuid===cluster.clusterUuid}));if(nodes.length===0){return"continue"}var firingNodeUuids=nodes.reduce((function(list,node){var stat=node.meta;if(node.shouldFire){list.push(stat.nodeId)}return list}),[]);firingNodeUuids.sort();var instanceId="".concat(_this3.type,":").concat(cluster.clusterUuid,":").concat(firingNodeUuids.join(","));var instance=services.alertInstanceFactory(instanceId);var state=instance.getState();var alertInstanceState={alertStates:(state===null||state===void 0?void 0:state.alertStates)||[]};var shouldExecuteActions=false;var _iterator4=cpu_usage_alert_createForOfIteratorHelper(nodes),_step4;try{var _loop2=function _loop2(){var node=_step4.value;var stat=node.meta;var nodeState=void 0;var indexInState=alertInstanceState.alertStates.findIndex((function(alertState){var nodeAlertState=alertState;return nodeAlertState.cluster.clusterUuid===cluster.clusterUuid&&nodeAlertState.nodeId===node.meta.nodeId}));if(indexInState>-1){nodeState=alertInstanceState.alertStates[indexInState]}else{nodeState=_this3.getDefaultAlertState(cluster,node)}nodeState.cpuUsage=stat.cpuUsage;nodeState.nodeId=stat.nodeId;nodeState.nodeName=stat.nodeName;if(node.shouldFire){if(!nodeState.ui.isFiring){nodeState.ui.triggeredMS=(new Date).valueOf()}nodeState.ui.isFiring=true;nodeState.ui.message=_this3.getUiMessage(nodeState,node);nodeState.ui.severity=node.severity;nodeState.ui.resolvedMS=0;shouldExecuteActions=true}else if(!node.shouldFire&&nodeState.ui.isFiring){nodeState.ui.isFiring=false;nodeState.ui.resolvedMS=(new Date).valueOf();nodeState.ui.message=_this3.getUiMessage(nodeState,node);shouldExecuteActions=true}if(indexInState===-1){alertInstanceState.alertStates.push(nodeState)}else{alertInstanceState.alertStates=[].concat(cpu_usage_alert_toConsumableArray(alertInstanceState.alertStates.slice(0,indexInState)),[nodeState],cpu_usage_alert_toConsumableArray(alertInstanceState.alertStates.slice(indexInState+1)))}};for(_iterator4.s();!(_step4=_iterator4.n()).done;){_loop2()}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}instance.replaceState(alertInstanceState);if(shouldExecuteActions){_this3.executeActions(instance,alertInstanceState,null,cluster)}};_iterator3.s();case 4:if((_step3=_iterator3.n()).done){_context2.next=10;break}_ret=_loop();if(!(_ret==="continue")){_context2.next=8;break}return _context2.abrupt("continue",8);case 8:_context2.next=4;break;case 10:_context2.next=15;break;case 12:_context2.prev=12;_context2.t0=_context2["catch"](1);_iterator3.e(_context2.t0);case 15:_context2.prev=15;_iterator3.f();return _context2.finish(15);case 18:case"end":return _context2.stop()}}}),_callee2,null,[[1,12,15,18]])})));function processData(_x6,_x7,_x8){return _processData.apply(this,arguments)}return processData}()}]);return CpuUsageAlert}(base_alert_BaseAlert);cpu_usage_alert_defineProperty(cpu_usage_alert_CpuUsageAlert,"paramDetails",{threshold:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.paramDetails.threshold.label",{defaultMessage:"Notify when CPU is over"}),type:enums["c"].Percentage},duration:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.cpuUsage.paramDetails.duration.label",{defaultMessage:"Look at the average over"}),type:enums["c"].Duration}});function fetch_missing_monitoring_data_toConsumableArray(arr){return fetch_missing_monitoring_data_arrayWithoutHoles(arr)||fetch_missing_monitoring_data_iterableToArray(arr)||fetch_missing_monitoring_data_unsupportedIterableToArray(arr)||fetch_missing_monitoring_data_nonIterableSpread()}function fetch_missing_monitoring_data_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fetch_missing_monitoring_data_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function fetch_missing_monitoring_data_arrayWithoutHoles(arr){if(Array.isArray(arr))return fetch_missing_monitoring_data_arrayLikeToArray(arr)}function fetch_missing_monitoring_data_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=fetch_missing_monitoring_data_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function fetch_missing_monitoring_data_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return fetch_missing_monitoring_data_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fetch_missing_monitoring_data_arrayLikeToArray(o,minLen)}function fetch_missing_monitoring_data_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function fetch_missing_monitoring_data_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_missing_monitoring_data_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_missing_monitoring_data_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_missing_monitoring_data_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function getStackProductFromIndex(index,beatType){if(index.includes("-kibana-")){return constants["J"]}if(index.includes("-beats-")){if(beatType==="apm-server"){return constants["k"]}return constants["l"]}if(index.includes("-logstash-")){return constants["M"]}if(index.includes("-es-")){return constants["A"]}return""}function fetchMissingMonitoringData(_x,_x2,_x3,_x4,_x5,_x6){return _fetchMissingMonitoringData.apply(this,arguments)}function _fetchMissingMonitoringData(){_fetchMissingMonitoringData=fetch_missing_monitoring_data_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,clusters,index,size,nowInMs,startMs){var endMs,nameFields,subAggs,params,response,clusterBuckets,uniqueList,_iterator,_step,_clusterBucket$es_uui,_clusterBucket$kibana,_clusterBucket$logsta,_clusterBucket$beats,_clusterBucket$apms,clusterBucket,clusterUuid,uuidBuckets,_iterator2,_step2,uuidBucket,stackProductUuid,indexName,stackProduct,differenceInMs,stackProductName,_iterator3,_step3,nameField,missingData;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:endMs=nowInMs;nameFields=["source_node.name","kibana_stats.kibana.name","logstash_stats.logstash.host","beats_stats.beat.name","beat_stats.beat.type"];subAggs={most_recent:{max:{field:"timestamp"}},document:{top_hits:{size:1,sort:[{timestamp:{order:"desc"}}],_source:{includes:["_index"].concat(nameFields)}}}};params={index:index,filterPath:["aggregations.clusters.buckets"],body:{size:0,query:{bool:{filter:[{terms:{cluster_uuid:clusters.map((function(cluster){return cluster.clusterUuid}))}},{range:{timestamp:{format:"epoch_millis",gte:startMs,lte:endMs}}}]}},aggs:{clusters:{terms:{field:"cluster_uuid",size:size},aggs:{es_uuids:{terms:{field:"node_stats.node_id",size:size},aggs:subAggs},kibana_uuids:{terms:{field:"kibana_stats.kibana.uuid",size:size},aggs:subAggs},beats:{filter:{bool:{must_not:{term:{"beats_stats.beat.type":"apm-server"}}}},aggs:{beats_uuids:{terms:{field:"beats_stats.beat.uuid",size:size},aggs:subAggs}}},apms:{filter:{bool:{must:{term:{"beats_stats.beat.type":"apm-server"}}}},aggs:{apm_uuids:{terms:{field:"beats_stats.beat.uuid",size:size},aggs:subAggs}}},logstash_uuids:{terms:{field:"logstash_stats.logstash.uuid",size:size},aggs:subAggs}}}}}};_context.next=6;return callCluster("search",params);case 6:response=_context.sent;clusterBuckets=Object(external_kbnSharedDeps_Lodash_["get"])(response,"aggregations.clusters.buckets",[]);uniqueList={};_iterator=fetch_missing_monitoring_data_createForOfIteratorHelper(clusterBuckets);_context.prev=10;_iterator.s();case 12:if((_step=_iterator.n()).done){_context.next=57;break}clusterBucket=_step.value;clusterUuid=clusterBucket.key;uuidBuckets=[].concat(fetch_missing_monitoring_data_toConsumableArray(((_clusterBucket$es_uui=clusterBucket.es_uuids)===null||_clusterBucket$es_uui===void 0?void 0:_clusterBucket$es_uui.buckets)||[]),fetch_missing_monitoring_data_toConsumableArray(((_clusterBucket$kibana=clusterBucket.kibana_uuids)===null||_clusterBucket$kibana===void 0?void 0:_clusterBucket$kibana.buckets)||[]),fetch_missing_monitoring_data_toConsumableArray(((_clusterBucket$logsta=clusterBucket.logstash_uuids)===null||_clusterBucket$logsta===void 0?void 0:_clusterBucket$logsta.buckets)||[]),fetch_missing_monitoring_data_toConsumableArray(((_clusterBucket$beats=clusterBucket.beats)===null||_clusterBucket$beats===void 0?void 0:_clusterBucket$beats.beats_uuids.buckets)||[]),fetch_missing_monitoring_data_toConsumableArray(((_clusterBucket$apms=clusterBucket.apms)===null||_clusterBucket$apms===void 0?void 0:_clusterBucket$apms.apm_uuids.buckets)||[]));_iterator2=fetch_missing_monitoring_data_createForOfIteratorHelper(uuidBuckets);_context.prev=17;_iterator2.s();case 19:if((_step2=_iterator2.n()).done){_context.next=47;break}uuidBucket=_step2.value;stackProductUuid=uuidBucket.key;indexName=Object(external_kbnSharedDeps_Lodash_["get"])(uuidBucket,"document.hits.hits[0]._index");stackProduct=getStackProductFromIndex(indexName,Object(external_kbnSharedDeps_Lodash_["get"])(uuidBucket,"document.hits.hits[0]._source.beats_stats.beat.type"));differenceInMs=nowInMs-uuidBucket.most_recent.value;stackProductName=stackProductUuid;_iterator3=fetch_missing_monitoring_data_createForOfIteratorHelper(nameFields);_context.prev=27;_iterator3.s();case 29:if((_step3=_iterator3.n()).done){_context.next=36;break}nameField=_step3.value;stackProductName=Object(external_kbnSharedDeps_Lodash_["get"])(uuidBucket,"document.hits.hits[0]._source.".concat(nameField));if(!stackProductName){_context.next=34;break}return _context.abrupt("break",36);case 34:_context.next=29;break;case 36:_context.next=41;break;case 38:_context.prev=38;_context.t0=_context["catch"](27);_iterator3.e(_context.t0);case 41:_context.prev=41;_iterator3.f();return _context.finish(41);case 44:uniqueList["".concat(clusterUuid).concat(stackProduct).concat(stackProductUuid)]={stackProduct:stackProduct,stackProductUuid:stackProductUuid,stackProductName:stackProductName,clusterUuid:clusterUuid,gapDuration:differenceInMs,ccs:indexName.includes(":")?indexName.split(":")[0]:null};case 45:_context.next=19;break;case 47:_context.next=52;break;case 49:_context.prev=49;_context.t1=_context["catch"](17);_iterator2.e(_context.t1);case 52:_context.prev=52;_iterator2.f();return _context.finish(52);case 55:_context.next=12;break;case 57:_context.next=62;break;case 59:_context.prev=59;_context.t2=_context["catch"](10);_iterator.e(_context.t2);case 62:_context.prev=62;_iterator.f();return _context.finish(62);case 65:missingData=Object.values(uniqueList);return _context.abrupt("return",missingData);case 67:case"end":return _context.stop()}}}),_callee,null,[[10,59,62,65],[17,49,52,55],[27,38,41,44]])})));return _fetchMissingMonitoringData.apply(this,arguments)}var NODES=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.nodes",{defaultMessage:"nodes"});var INSTANCES=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.instances",{defaultMessage:"instances"});var SERVERS=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.servers",{defaultMessage:"servers"});var NODE=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.node",{defaultMessage:"node"});var INSTANCE=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.instance",{defaultMessage:"instance"});var SERVER=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.typeLabel.server",{defaultMessage:"server"});function getTypeLabelForStackProduct(stackProduct){var plural=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;switch(stackProduct){case constants["A"]:case constants["M"]:return plural?NODES:NODE;case constants["J"]:case constants["l"]:return plural?INSTANCES:INSTANCE;case constants["k"]:return plural?SERVERS:SERVER}return"n/a"}function getListingLinkForStackProduct(stackProduct){switch(stackProduct){case constants["A"]:return"elasticsearch/nodes";case constants["M"]:return"logstash/nodes";case constants["J"]:return"kibana/instances";case constants["l"]:return"beats/beats";case constants["k"]:return"apm/instances"}return""}function getStackProductLabel(stackProduct){switch(stackProduct){case constants["k"]:return"APM";case constants["l"]:return"Beat"}return Object(external_kbnSharedDeps_Lodash_["capitalize"])(stackProduct)}function missing_monitoring_data_alert_ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}));keys.push.apply(keys,symbols)}return keys}function missing_monitoring_data_alert_objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){missing_monitoring_data_alert_ownKeys(Object(source),true).forEach((function(key){missing_monitoring_data_alert_defineProperty(target,key,source[key])}))}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{missing_monitoring_data_alert_ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}}return target}function missing_monitoring_data_alert_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=missing_monitoring_data_alert_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function missing_monitoring_data_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function missing_monitoring_data_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){missing_monitoring_data_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){missing_monitoring_data_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function missing_monitoring_data_alert_toConsumableArray(arr){return missing_monitoring_data_alert_arrayWithoutHoles(arr)||missing_monitoring_data_alert_iterableToArray(arr)||missing_monitoring_data_alert_unsupportedIterableToArray(arr)||missing_monitoring_data_alert_nonIterableSpread()}function missing_monitoring_data_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function missing_monitoring_data_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return missing_monitoring_data_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return missing_monitoring_data_alert_arrayLikeToArray(o,minLen)}function missing_monitoring_data_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function missing_monitoring_data_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return missing_monitoring_data_alert_arrayLikeToArray(arr)}function missing_monitoring_data_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function missing_monitoring_data_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function missing_monitoring_data_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function missing_monitoring_data_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)missing_monitoring_data_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)missing_monitoring_data_alert_defineProperties(Constructor,staticProps);return Constructor}function missing_monitoring_data_alert_get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){missing_monitoring_data_alert_get=Reflect.get}else{missing_monitoring_data_alert_get=function _get(target,property,receiver){var base=missing_monitoring_data_alert_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return missing_monitoring_data_alert_get(target,property,receiver||target)}function missing_monitoring_data_alert_superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=missing_monitoring_data_alert_getPrototypeOf(object);if(object===null)break}return object}function missing_monitoring_data_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)missing_monitoring_data_alert_setPrototypeOf(subClass,superClass)}function missing_monitoring_data_alert_setPrototypeOf(o,p){missing_monitoring_data_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return missing_monitoring_data_alert_setPrototypeOf(o,p)}function missing_monitoring_data_alert_createSuper(Derived){var hasNativeReflectConstruct=missing_monitoring_data_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=missing_monitoring_data_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=missing_monitoring_data_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return missing_monitoring_data_alert_possibleConstructorReturn(this,result)}}function missing_monitoring_data_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return missing_monitoring_data_alert_assertThisInitialized(self)}function missing_monitoring_data_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function missing_monitoring_data_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function missing_monitoring_data_alert_getPrototypeOf(o){missing_monitoring_data_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return missing_monitoring_data_alert_getPrototypeOf(o)}function missing_monitoring_data_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var RESOLVED=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.resolved",{defaultMessage:"resolved"});var FIRING=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.firing",{defaultMessage:"firing"});var missing_monitoring_data_alert_DEFAULT_DURATION="15m";var DEFAULT_LIMIT="1d";var LIMIT_BUFFER=3*60*1e3;var missing_monitoring_data_alert_MissingMonitoringDataAlert=function(_BaseAlert){missing_monitoring_data_alert_inherits(MissingMonitoringDataAlert,_BaseAlert);var _super=missing_monitoring_data_alert_createSuper(MissingMonitoringDataAlert);function MissingMonitoringDataAlert(){var _this;missing_monitoring_data_alert_classCallCheck(this,MissingMonitoringDataAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_assertThisInitialized(_this),"defaultThrottle","6h");missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_assertThisInitialized(_this),"type",constants["i"]);missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.label",{defaultMessage:"Missing monitoring data"}));missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_assertThisInitialized(_this),"defaultParams",{duration:missing_monitoring_data_alert_DEFAULT_DURATION,limit:DEFAULT_LIMIT});missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_assertThisInitialized(_this),"actionVariables",[{name:"stackProducts",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.actionVariables.stackProducts",{defaultMessage:"The stack products missing monitoring data."})},{name:"count",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.actionVariables.count",{defaultMessage:"The number of stack products missing monitoring data."})}].concat(missing_monitoring_data_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}missing_monitoring_data_alert_createClass(MissingMonitoringDataAlert,[{key:"fetchClusters",value:function(){var _fetchClusters2=missing_monitoring_data_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster){var availableCcs,params,limit,ccs,esIndexPattern,_args=arguments;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:availableCcs=_args.length>1&&_args[1]!==undefined?_args[1]:undefined;params=_args.length>2?_args[2]:undefined;limit=Object(parse_duration_["parseDuration"])(params.limit);if(availableCcs){_context.next=14;break}if(!this.config.ui.ccs.enabled){_context.next=10;break}_context.next=7;return fetchAvailableCcs(callCluster);case 7:_context.t0=_context.sent;_context.next=11;break;case 10:_context.t0=undefined;case 11:ccs=_context.t0;_context.next=15;break;case 14:ccs=availableCcs;case 15:esIndexPattern=appendMetricbeatIndex(this.config,constants["H"]);if(ccs){esIndexPattern=getCcsIndexPattern(esIndexPattern,ccs)}_context.next=19;return fetch_clusters_fetchClusters(callCluster,esIndexPattern,{timestamp:{format:"epoch_millis",gte:limit-LIMIT_BUFFER}});case 19:return _context.abrupt("return",_context.sent);case 20:case"end":return _context.stop()}}}),_callee,this)})));function fetchClusters(_x){return _fetchClusters2.apply(this,arguments)}return fetchClusters}()},{key:"fetchData",value:function(){var _fetchData=missing_monitoring_data_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(params,callCluster,clusters,uiSettings,availableCcs){var indexPattern,duration,limit,now,missingData;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:indexPattern=appendMetricbeatIndex(this.config,constants["G"]);if(availableCcs){indexPattern=getCcsIndexPattern(indexPattern,availableCcs)}duration=Object(parse_duration_["parseDuration"])(params.duration);limit=Object(parse_duration_["parseDuration"])(params.limit);now=+new Date;_context2.next=7;return fetchMissingMonitoringData(callCluster,clusters,indexPattern,this.config.ui.max_bucket_size,now,now-limit-LIMIT_BUFFER);case 7:missingData=_context2.sent;return _context2.abrupt("return",missingData.map((function(missing){return{instanceKey:"".concat(missing.clusterUuid,":").concat(missing.stackProduct,":").concat(missing.stackProductUuid),clusterUuid:missing.clusterUuid,shouldFire:missing.gapDuration>duration,severity:enums["d"].Danger,meta:{missing:missing,limit:limit},ccs:missing.ccs}})));case 9:case"end":return _context2.stop()}}}),_callee2,this)})));function fetchData(_x2,_x3,_x4,_x5,_x6){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"filterAlertInstance",value:function filterAlertInstance(alertInstance,filters){var alertInstanceState=alertInstance.state;if(filters&&filters.length){var _iterator=missing_monitoring_data_alert_createForOfIteratorHelper(filters),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var filter=_step.value;var stackProductFilter=filter;if(stackProductFilter&&stackProductFilter.stackProduct){var existsInState=false;var _iterator2=missing_monitoring_data_alert_createForOfIteratorHelper(alertInstanceState.alertStates),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var state=_step2.value;if(state.stackProduct===stackProductFilter.stackProduct){existsInState=true;break}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}if(!existsInState){return false}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}return true}},{key:"filterAlertState",value:function filterAlertState(alertState,filters){var state=alertState;if(filters&&filters.length){var _iterator3=missing_monitoring_data_alert_createForOfIteratorHelper(filters),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var filter=_step3.value;var stackProductFilter=filter;if(stackProductFilter&&stackProductFilter.stackProduct){if(state.stackProduct!==stackProductFilter.stackProduct){return false}}var nodeUuidFilter=filter;if(nodeUuidFilter&&nodeUuidFilter.nodeUuid){if(state.stackProductUuid!==nodeUuidFilter.nodeUuid){return false}}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}}return true}},{key:"getDefaultAlertState",value:function getDefaultAlertState(cluster,item){var base=missing_monitoring_data_alert_get(missing_monitoring_data_alert_getPrototypeOf(MissingMonitoringDataAlert.prototype),"getDefaultAlertState",this).call(this,cluster,item);return missing_monitoring_data_alert_objectSpread(missing_monitoring_data_alert_objectSpread({},base),{},{ui:missing_monitoring_data_alert_objectSpread(missing_monitoring_data_alert_objectSpread({},base.ui),{},{severity:enums["d"].Danger})})}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var _ref=item.meta,missing=_ref.missing,limit=_ref.limit;if(!alertState.ui.isFiring){if(missing.gapDuration>limit){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.ui.notQuiteResolvedMessage",{defaultMessage:"We are still not seeing monitoring data for the {stackProduct} {type}: {stackProductName} and will stop trying. To change this, configure the alert to look farther back for data.",values:{stackProduct:getStackProductLabel(missing.stackProduct),type:getTypeLabelForStackProduct(missing.stackProduct,false),stackProductName:missing.stackProductName}})}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.ui.resolvedMessage",{defaultMessage:"We are now seeing monitoring data for the {stackProduct} {type}: {stackProductName}, as of #resolved",values:{stackProduct:getStackProductLabel(missing.stackProduct),type:getTypeLabelForStackProduct(missing.stackProduct,false),stackProductName:missing.stackProductName}}),tokens:[{startToken:"#resolved",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.resolvedMS}]}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.ui.firingMessage",{defaultMessage:"For the past {gapDuration}, we have not detected any monitoring data from the {stackProduct} {type}: {stackProductName}, starting at #absolute",values:{gapDuration:external_kbnSharedDeps_Moment_default.a.duration(missing.gapDuration,"milliseconds").humanize(),stackProduct:getStackProductLabel(missing.stackProduct),type:getTypeLabelForStackProduct(missing.stackProduct,false),stackProductName:missing.stackProductName}}),nextSteps:[alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.ui.nextSteps.viewAll",{defaultMessage:"#start_linkView all {stackProduct} {type}#end_link",values:{type:getTypeLabelForStackProduct(missing.stackProduct),stackProduct:getStackProductLabel(missing.stackProduct)}}),getListingLinkForStackProduct(missing.stackProduct),enums["b"].Link),{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.ui.nextSteps.verifySettings",{defaultMessage:"Verify monitoring settings on the {type}",values:{type:getTypeLabelForStackProduct(missing.stackProduct,false)}})}],tokens:[{startToken:"#absolute",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.triggeredMS}]}}},{key:"executeActions",value:function executeActions(instance,instanceState,item,cluster){if(instanceState.alertStates.length===0){return}var firingCount=instanceState.alertStates.filter((function(alertState){return alertState.ui.isFiring})).length;var firingStackProducts=instanceState.alertStates.filter((function(_state){return _state.ui.isFiring})).map((function(_state){var state=_state;return"".concat(getStackProductLabel(state.stackProduct)," ").concat(getTypeLabelForStackProduct(state.stackProduct,false),": ").concat(state.stackProductName)})).join(", ");if(firingCount>0){var _instanceState$alertS;var shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.shortAction",{defaultMessage:"Verify these stack products are up and running, then double check the monitoring settings."});var fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.fullAction",{defaultMessage:"View what monitoring data we do have for these stack products."});var ccs=(_instanceState$alertS=instanceState.alertStates.find((function(state){return state.ccs})))===null||_instanceState$alertS===void 0?void 0:_instanceState$alertS.ccs;var globalStateLink=this.createGlobalStateLink("overview",cluster.clusterUuid,ccs);var action="[".concat(fullActionText,"](").concat(globalStateLink,")");var internalShortMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.firing.internalShortMessage",{defaultMessage:"We have not detected any monitoring data for {count} stack product(s) in cluster: {clusterName}. {shortActionText}",values:{count:firingCount,clusterName:cluster.clusterName,shortActionText:shortActionText}});var internalFullMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.firing.internalFullMessage",{defaultMessage:"We have not detected any monitoring data for {count} stack product(s) in cluster: {clusterName}. {action}",values:{count:firingCount,clusterName:cluster.clusterName,action:action}});instance.scheduleActions("default",{internalShortMessage:internalShortMessage,internalFullMessage:this.isCloud?internalShortMessage:internalFullMessage,state:FIRING,stackProducts:firingStackProducts,count:firingCount,clusterName:cluster.clusterName,action:action,actionPlain:shortActionText})}else{var resolvedCount=instanceState.alertStates.filter((function(alertState){return!alertState.ui.isFiring})).length;var resolvedStackProducts=instanceState.alertStates.filter((function(_state){return!_state.ui.isFiring})).map((function(_state){var state=_state;return"".concat(getStackProductLabel(state.stackProduct)," ").concat(getTypeLabelForStackProduct(state.stackProduct,false),": ").concat(state.stackProductName)})).join(",");if(resolvedCount>0){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.resolved.internalShortMessage",{defaultMessage:"We are now seeing monitoring data for {count} stack product(s) in cluster: {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.resolved.internalFullMessage",{defaultMessage:"We are now seeing monitoring data for {count} stack product(s) in cluster {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}}),state:RESOLVED,stackProducts:resolvedStackProducts,count:resolvedCount,clusterName:cluster.clusterName})}}}},{key:"processData",value:function(){var _processData=missing_monitoring_data_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee3(data,clusters,services,logger){var _this2=this;var _iterator4,_step4,_loop,_ret;return regeneratorRuntime.wrap((function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_iterator4=missing_monitoring_data_alert_createForOfIteratorHelper(clusters);_context3.prev=1;_loop=function _loop(){var cluster=_step4.value;var stackProducts=data.filter((function(_item){return _item.clusterUuid===cluster.clusterUuid}));if(stackProducts.length===0){return"continue"}var firingInstances=stackProducts.reduce((function(list,stackProduct){var _ref2=stackProduct.meta,missing=_ref2.missing;if(stackProduct.shouldFire){list.push("".concat(missing.stackProduct,":").concat(missing.stackProductUuid))}return list}),[]);firingInstances.sort();var instanceId="".concat(_this2.type,":").concat(cluster.clusterUuid,":").concat(firingInstances.join(","));var instance=services.alertInstanceFactory(instanceId);var instanceState=instance.getState();var alertInstanceState={alertStates:(instanceState===null||instanceState===void 0?void 0:instanceState.alertStates)||[]};var shouldExecuteActions=false;var _iterator5=missing_monitoring_data_alert_createForOfIteratorHelper(stackProducts),_step5;try{var _loop2=function _loop2(){var stackProduct=_step5.value;var _ref3=stackProduct.meta,missing=_ref3.missing;var state=void 0;var indexInState=alertInstanceState.alertStates.findIndex((function(alertState){var _alertState=alertState;return _alertState.cluster.clusterUuid===cluster.clusterUuid&&_alertState.stackProduct===missing.stackProduct&&_alertState.stackProductUuid===missing.stackProductUuid}));if(indexInState>-1){state=alertInstanceState.alertStates[indexInState]}else{state=_this2.getDefaultAlertState(cluster,stackProduct)}state.stackProduct=missing.stackProduct;state.stackProductUuid=missing.stackProductUuid;state.stackProductName=missing.stackProductName;state.gapDuration=missing.gapDuration;if(stackProduct.shouldFire){if(!state.ui.isFiring){state.ui.triggeredMS=(new Date).valueOf()}state.ui.isFiring=true;state.ui.message=_this2.getUiMessage(state,stackProduct);state.ui.severity=stackProduct.severity;state.ui.resolvedMS=0;shouldExecuteActions=true}else if(!stackProduct.shouldFire&&state.ui.isFiring){state.ui.isFiring=false;state.ui.resolvedMS=(new Date).valueOf();state.ui.message=_this2.getUiMessage(state,stackProduct);shouldExecuteActions=true}if(indexInState===-1){alertInstanceState.alertStates.push(state)}else{alertInstanceState.alertStates=[].concat(missing_monitoring_data_alert_toConsumableArray(alertInstanceState.alertStates.slice(0,indexInState)),[state],missing_monitoring_data_alert_toConsumableArray(alertInstanceState.alertStates.slice(indexInState+1)))}};for(_iterator5.s();!(_step5=_iterator5.n()).done;){_loop2()}}catch(err){_iterator5.e(err)}finally{_iterator5.f()}instance.replaceState(alertInstanceState);if(shouldExecuteActions){_this2.executeActions(instance,alertInstanceState,null,cluster)}};_iterator4.s();case 4:if((_step4=_iterator4.n()).done){_context3.next=10;break}_ret=_loop();if(!(_ret==="continue")){_context3.next=8;break}return _context3.abrupt("continue",8);case 8:_context3.next=4;break;case 10:_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3["catch"](1);_iterator4.e(_context3.t0);case 15:_context3.prev=15;_iterator4.f();return _context3.finish(15);case 18:case"end":return _context3.stop()}}}),_callee3,null,[[1,12,15,18]])})));function processData(_x7,_x8,_x9,_x10){return _processData.apply(this,arguments)}return processData}()}]);return MissingMonitoringDataAlert}(base_alert_BaseAlert);missing_monitoring_data_alert_defineProperty(missing_monitoring_data_alert_MissingMonitoringDataAlert,"paramDetails",{duration:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.paramDetails.duration.label",{defaultMessage:"Notify if monitoring data is missing for the last"}),type:enums["c"].Duration},limit:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.paramDetails.limit.label",{defaultMessage:"looking back"}),type:enums["c"].Duration}});function fetch_disk_usage_node_stats_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=fetch_disk_usage_node_stats_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function fetch_disk_usage_node_stats_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return fetch_disk_usage_node_stats_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fetch_disk_usage_node_stats_arrayLikeToArray(o,minLen)}function fetch_disk_usage_node_stats_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function fetch_disk_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_disk_usage_node_stats_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_disk_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_disk_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchDiskUsageNodeStats(_x,_x2,_x3,_x4,_x5){return _fetchDiskUsageNodeStats.apply(this,arguments)}function _fetchDiskUsageNodeStats(){_fetchDiskUsageNodeStats=fetch_disk_usage_node_stats_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,clusters,index,duration,size){var clustersIds,params,response,stats,_response$aggregation,clusterBuckets,_iterator,_step,clusterBucket,_iterator2,_step2,node,indexName,diskUsage;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:clustersIds=clusters.map((function(cluster){return cluster.clusterUuid}));params={index:index,filterPath:["aggregations"],body:{size:0,query:{bool:{filter:[{terms:{cluster_uuid:clustersIds}},{term:{type:"node_stats"}},{range:{timestamp:{gte:"now-".concat(duration)}}}]}},aggs:{clusters:{terms:{field:"cluster_uuid",size:size,include:clustersIds},aggs:{nodes:{terms:{field:"node_stats.node_id",size:size},aggs:{index:{terms:{field:"_index",size:1}},total_in_bytes:{max:{field:"node_stats.fs.total.total_in_bytes"}},available_in_bytes:{max:{field:"node_stats.fs.total.available_in_bytes"}},usage_ratio_percentile:{bucket_script:{buckets_path:{available_in_bytes:"available_in_bytes",total_in_bytes:"total_in_bytes"},script:"100 - Math.floor((params.available_in_bytes / params.total_in_bytes) * 100)"}},name:{terms:{field:"source_node.name",size:1}}}}}}}}};_context.next=4;return callCluster("search",params);case 4:response=_context.sent;stats=[];_response$aggregation=response.aggregations.clusters.buckets,clusterBuckets=_response$aggregation===void 0?[]:_response$aggregation;if(clusterBuckets.length){_context.next=9;break}return _context.abrupt("return",stats);case 9:_iterator=fetch_disk_usage_node_stats_createForOfIteratorHelper(clusterBuckets);_context.prev=10;_iterator.s();case 12:if((_step=_iterator.n()).done){_context.next=36;break}clusterBucket=_step.value;_iterator2=fetch_disk_usage_node_stats_createForOfIteratorHelper(clusterBucket.nodes.buckets);_context.prev=15;_iterator2.s();case 17:if((_step2=_iterator2.n()).done){_context.next=26;break}node=_step2.value;indexName=Object(external_kbnSharedDeps_Lodash_["get"])(node,"index.buckets[0].key","");diskUsage=Number(Object(external_kbnSharedDeps_Lodash_["get"])(node,"usage_ratio_percentile.value"));if(!(isNaN(diskUsage)||diskUsage===undefined||diskUsage===null)){_context.next=23;break}return _context.abrupt("continue",24);case 23:stats.push({diskUsage:diskUsage,clusterUuid:clusterBucket.key,nodeId:node.key,nodeName:Object(external_kbnSharedDeps_Lodash_["get"])(node,"name.buckets[0].key"),ccs:indexName.includes(":")?indexName.split(":")[0]:null});case 24:_context.next=17;break;case 26:_context.next=31;break;case 28:_context.prev=28;_context.t0=_context["catch"](15);_iterator2.e(_context.t0);case 31:_context.prev=31;_iterator2.f();return _context.finish(31);case 34:_context.next=12;break;case 36:_context.next=41;break;case 38:_context.prev=38;_context.t1=_context["catch"](10);_iterator.e(_context.t1);case 41:_context.prev=41;_iterator.f();return _context.finish(41);case 44:return _context.abrupt("return",stats);case 45:case"end":return _context.stop()}}}),_callee,null,[[10,38,41,44],[15,28,31,34]])})));return _fetchDiskUsageNodeStats.apply(this,arguments)}function disk_usage_alert_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=disk_usage_alert_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function disk_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function disk_usage_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){disk_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){disk_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function disk_usage_alert_toConsumableArray(arr){return disk_usage_alert_arrayWithoutHoles(arr)||disk_usage_alert_iterableToArray(arr)||disk_usage_alert_unsupportedIterableToArray(arr)||disk_usage_alert_nonIterableSpread()}function disk_usage_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function disk_usage_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return disk_usage_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return disk_usage_alert_arrayLikeToArray(o,minLen)}function disk_usage_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function disk_usage_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return disk_usage_alert_arrayLikeToArray(arr)}function disk_usage_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function disk_usage_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function disk_usage_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function disk_usage_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)disk_usage_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)disk_usage_alert_defineProperties(Constructor,staticProps);return Constructor}function disk_usage_alert_get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){disk_usage_alert_get=Reflect.get}else{disk_usage_alert_get=function _get(target,property,receiver){var base=disk_usage_alert_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return disk_usage_alert_get(target,property,receiver||target)}function disk_usage_alert_superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=disk_usage_alert_getPrototypeOf(object);if(object===null)break}return object}function disk_usage_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)disk_usage_alert_setPrototypeOf(subClass,superClass)}function disk_usage_alert_setPrototypeOf(o,p){disk_usage_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return disk_usage_alert_setPrototypeOf(o,p)}function disk_usage_alert_createSuper(Derived){var hasNativeReflectConstruct=disk_usage_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=disk_usage_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=disk_usage_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return disk_usage_alert_possibleConstructorReturn(this,result)}}function disk_usage_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return disk_usage_alert_assertThisInitialized(self)}function disk_usage_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function disk_usage_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function disk_usage_alert_getPrototypeOf(o){disk_usage_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return disk_usage_alert_getPrototypeOf(o)}function disk_usage_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var disk_usage_alert_DiskUsageAlert=function(_BaseAlert){disk_usage_alert_inherits(DiskUsageAlert,_BaseAlert);var _super=disk_usage_alert_createSuper(DiskUsageAlert);function DiskUsageAlert(){var _this;disk_usage_alert_classCallCheck(this,DiskUsageAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));disk_usage_alert_defineProperty(disk_usage_alert_assertThisInitialized(_this),"type",DiskUsageAlert.TYPE);disk_usage_alert_defineProperty(disk_usage_alert_assertThisInitialized(_this),"label",DiskUsageAlert.LABEL);disk_usage_alert_defineProperty(disk_usage_alert_assertThisInitialized(_this),"defaultParams",{threshold:80,duration:"5m"});disk_usage_alert_defineProperty(disk_usage_alert_assertThisInitialized(_this),"actionVariables",[{name:"nodes",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.actionVariables.nodes",{defaultMessage:"The list of nodes reporting high disk usage."})},{name:"count",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.actionVariables.count",{defaultMessage:"The number of nodes reporting high disk usage."})}].concat(disk_usage_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}disk_usage_alert_createClass(DiskUsageAlert,[{key:"fetchData",value:function(){var _fetchData=disk_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var esIndexPattern,duration,threshold,stats;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:esIndexPattern=appendMetricbeatIndex(this.config,constants["H"]);if(availableCcs){esIndexPattern=getCcsIndexPattern(esIndexPattern,availableCcs)}duration=params.duration,threshold=params.threshold;_context.next=5;return fetchDiskUsageNodeStats(callCluster,clusters,esIndexPattern,duration,this.config.ui.max_bucket_size);case 5:stats=_context.sent;return _context.abrupt("return",stats.map((function(stat){var clusterUuid=stat.clusterUuid,nodeId=stat.nodeId,diskUsage=stat.diskUsage,ccs=stat.ccs;return{instanceKey:"".concat(clusterUuid,":").concat(nodeId),shouldFire:diskUsage>threshold,severity:enums["d"].Danger,meta:stat,clusterUuid:clusterUuid,ccs:ccs}})));case 7:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"filterAlertInstance",value:function filterAlertInstance(alertInstance,filters){var _alertInstance$state;var alertInstanceStates=(_alertInstance$state=alertInstance.state)===null||_alertInstance$state===void 0?void 0:_alertInstance$state.alertStates;var nodeFilter=filters===null||filters===void 0?void 0:filters.find((function(filter){return filter.nodeUuid}));if(!filters||!filters.length||!(alertInstanceStates===null||alertInstanceStates===void 0?void 0:alertInstanceStates.length)||!(nodeFilter===null||nodeFilter===void 0?void 0:nodeFilter.nodeUuid)){return true}var nodeAlerts=alertInstanceStates.filter((function(_ref){var nodeId=_ref.nodeId;return nodeId===nodeFilter.nodeUuid}));return Boolean(nodeAlerts.length)}},{key:"getDefaultAlertState",value:function getDefaultAlertState(cluster,item){var currentState=disk_usage_alert_get(disk_usage_alert_getPrototypeOf(DiskUsageAlert.prototype),"getDefaultAlertState",this).call(this,cluster,item);currentState.ui.severity=enums["d"].Warning;return currentState}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var stat=item.meta;if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.resolvedMessage",{defaultMessage:"The disk usage on node {nodeName} is now under the threshold, currently reporting at {diskUsage}% as of #resolved",values:{nodeName:stat.nodeName,diskUsage:stat.diskUsage.toFixed(2)}}),tokens:[{startToken:"#resolved",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.resolvedMS}]}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.firingMessage",{defaultMessage:"Node #start_link{nodeName}#end_link is reporting disk usage of {diskUsage}% at #absolute",values:{nodeName:stat.nodeName,diskUsage:stat.diskUsage}}),nextSteps:[alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.nextSteps.tuneDisk",{defaultMessage:"#start_linkTune for disk usage#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/tune-for-disk-usage.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.nextSteps.identifyIndices",{defaultMessage:"#start_linkIdentify large indices#end_link"}),"elasticsearch/indices",enums["b"].Link),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.nextSteps.ilmPolicies",{defaultMessage:"#start_linkImplement ILM policies#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/index-lifecycle-management.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.nextSteps.addMoreNodes",{defaultMessage:"#start_linkAdd more data nodes#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/add-elasticsearch-nodes.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.ui.nextSteps.resizeYourDeployment",{defaultMessage:"#start_linkResize your deployment (ECE)#end_link"}),"{elasticWebsiteUrl}guide/en/cloud-enterprise/current/ece-resize-deployment.html")],tokens:[{startToken:"#absolute",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.triggeredMS},{startToken:"#start_link",endToken:"#end_link",type:enums["b"].Link,url:"elasticsearch/nodes/".concat(stat.nodeId)}]}}},{key:"executeActions",value:function executeActions(instance,_ref2,item,cluster){var alertStates=_ref2.alertStates;var firingNodes=alertStates.filter((function(alertState){return alertState.ui.isFiring}));var firingCount=firingNodes.length;if(firingCount>0){var shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.shortAction",{defaultMessage:"Verify disk usage levels across affected nodes."});var fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.fullAction",{defaultMessage:"View nodes"});var action="[".concat(fullActionText,"](elasticsearch/nodes)");var internalShortMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.firing.internalShortMessage",{defaultMessage:"Disk usage alert is firing for {count} node(s) in cluster: {clusterName}. {shortActionText}",values:{count:firingCount,clusterName:cluster.clusterName,shortActionText:shortActionText}});var internalFullMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.firing.internalFullMessage",{defaultMessage:"Disk usage alert is firing for {count} node(s) in cluster: {clusterName}. {action}",values:{count:firingCount,clusterName:cluster.clusterName,action:action}});instance.scheduleActions("default",{internalShortMessage:internalShortMessage,internalFullMessage:this.isCloud?internalShortMessage:internalFullMessage,state:AlertingDefaults.ALERT_STATE.firing,nodes:firingNodes.map((function(state){return"".concat(state.nodeName,":").concat(state.diskUsage.toFixed(2))})).join(","),count:firingCount,clusterName:cluster.clusterName,action:action,actionPlain:shortActionText})}else{var resolvedNodes=alertStates.filter((function(state){return!state.ui.isFiring})).map((function(state){return"".concat(state.nodeName,":").concat(state.diskUsage.toFixed(2))}));var resolvedCount=resolvedNodes.length;if(resolvedCount>0){var internalMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.resolved.internalMessage",{defaultMessage:"Disk usage alert is resolved for {count} node(s) in cluster: {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}});instance.scheduleActions("default",{internalShortMessage:internalMessage,internalFullMessage:internalMessage,state:AlertingDefaults.ALERT_STATE.resolved,nodes:resolvedNodes.join(","),count:resolvedCount,clusterName:cluster.clusterName})}}}},{key:"processData",value:function(){var _processData=disk_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(data,clusters,services,logger,state){var _this2=this;var currentUTC,_iterator,_step,_loop,_ret;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:currentUTC=+new Date;_iterator=disk_usage_alert_createForOfIteratorHelper(clusters);_context2.prev=2;_loop=function _loop(){var cluster=_step.value;var nodes=data.filter((function(node){return node.clusterUuid===cluster.clusterUuid}));if(!nodes.length){return"continue"}var firingNodeUuids=nodes.filter((function(node){return node.shouldFire})).map((function(node){return node.meta.nodeId})).join(",");var instanceId="".concat(_this2.type,":").concat(cluster.clusterUuid,":").concat(firingNodeUuids);var instance=services.alertInstanceFactory(instanceId);var newAlertStates=[];var _iterator2=disk_usage_alert_createForOfIteratorHelper(nodes),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var node=_step2.value;var stat=node.meta;var nodeState=_this2.getDefaultAlertState(cluster,node);nodeState.diskUsage=stat.diskUsage;nodeState.nodeId=stat.nodeId;nodeState.nodeName=stat.nodeName;if(node.shouldFire){nodeState.ui.triggeredMS=currentUTC;nodeState.ui.isFiring=true;nodeState.ui.severity=node.severity;newAlertStates.push(nodeState)}nodeState.ui.message=_this2.getUiMessage(nodeState,node)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var alertInstanceState={alertStates:newAlertStates};instance.replaceState(alertInstanceState);if(newAlertStates.length){_this2.executeActions(instance,alertInstanceState,null,cluster);state.lastExecutedAction=currentUTC}};_iterator.s();case 5:if((_step=_iterator.n()).done){_context2.next=11;break}_ret=_loop();if(!(_ret==="continue")){_context2.next=9;break}return _context2.abrupt("continue",9);case 9:_context2.next=5;break;case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](2);_iterator.e(_context2.t0);case 16:_context2.prev=16;_iterator.f();return _context2.finish(16);case 19:state.lastChecked=currentUTC;return _context2.abrupt("return",state);case 21:case"end":return _context2.stop()}}}),_callee2,null,[[2,13,16,19]])})));function processData(_x6,_x7,_x8,_x9,_x10){return _processData.apply(this,arguments)}return processData}()}]);return DiskUsageAlert}(base_alert_BaseAlert);disk_usage_alert_defineProperty(disk_usage_alert_DiskUsageAlert,"PARAM_DETAILS",{threshold:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.paramDetails.threshold.label",{defaultMessage:"Notify when disk capacity is over"}),type:enums["c"].Percentage},duration:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.paramDetails.duration.label",{defaultMessage:"Look at the average over"}),type:enums["c"].Duration}});disk_usage_alert_defineProperty(disk_usage_alert_DiskUsageAlert,"paramDetails",disk_usage_alert_DiskUsageAlert.PARAM_DETAILS);disk_usage_alert_defineProperty(disk_usage_alert_DiskUsageAlert,"TYPE",constants["c"]);disk_usage_alert_defineProperty(disk_usage_alert_DiskUsageAlert,"LABEL",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.diskUsage.label",{defaultMessage:"Disk Usage"}));function fetch_memory_usage_node_stats_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=fetch_memory_usage_node_stats_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function fetch_memory_usage_node_stats_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return fetch_memory_usage_node_stats_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fetch_memory_usage_node_stats_arrayLikeToArray(o,minLen)}function fetch_memory_usage_node_stats_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function fetch_memory_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_memory_usage_node_stats_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_memory_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_memory_usage_node_stats_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchMemoryUsageNodeStats(_x,_x2,_x3,_x4,_x5,_x6){return _fetchMemoryUsageNodeStats.apply(this,arguments)}function _fetchMemoryUsageNodeStats(){_fetchMemoryUsageNodeStats=fetch_memory_usage_node_stats_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,clusters,index,startMs,endMs,size){var clustersIds,params,response,stats,_response$aggregation,clusterBuckets,_iterator,_step,clusterBucket,_iterator2,_step2,node,indexName,memoryUsage;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:clustersIds=clusters.map((function(cluster){return cluster.clusterUuid}));params={index:index,filterPath:["aggregations"],body:{size:0,query:{bool:{filter:[{terms:{cluster_uuid:clustersIds}},{term:{type:"node_stats"}},{range:{timestamp:{format:"epoch_millis",gte:startMs,lte:endMs}}}]}},aggs:{clusters:{terms:{field:"cluster_uuid",size:size},aggs:{nodes:{terms:{field:"source_node.uuid",size:size},aggs:{index:{terms:{field:"_index",size:1}},avg_heap:{avg:{field:"node_stats.jvm.mem.heap_used_percent"}},cluster_uuid:{terms:{field:"cluster_uuid",size:1}},name:{terms:{field:"source_node.name",size:1}}}}}}}}};_context.next=4;return callCluster("search",params);case 4:response=_context.sent;stats=[];_response$aggregation=response.aggregations.clusters.buckets,clusterBuckets=_response$aggregation===void 0?[]:_response$aggregation;if(clusterBuckets.length){_context.next=9;break}return _context.abrupt("return",stats);case 9:_iterator=fetch_memory_usage_node_stats_createForOfIteratorHelper(clusterBuckets);_context.prev=10;_iterator.s();case 12:if((_step=_iterator.n()).done){_context.next=36;break}clusterBucket=_step.value;_iterator2=fetch_memory_usage_node_stats_createForOfIteratorHelper(clusterBucket.nodes.buckets);_context.prev=15;_iterator2.s();case 17:if((_step2=_iterator2.n()).done){_context.next=26;break}node=_step2.value;indexName=Object(external_kbnSharedDeps_Lodash_["get"])(node,"index.buckets[0].key","");memoryUsage=Math.floor(Number(Object(external_kbnSharedDeps_Lodash_["get"])(node,"avg_heap.value")));if(!(isNaN(memoryUsage)||memoryUsage===undefined||memoryUsage===null)){_context.next=23;break}return _context.abrupt("continue",24);case 23:stats.push({memoryUsage:memoryUsage,clusterUuid:clusterBucket.key,nodeId:node.key,nodeName:Object(external_kbnSharedDeps_Lodash_["get"])(node,"name.buckets[0].key"),ccs:indexName.includes(":")?indexName.split(":")[0]:null});case 24:_context.next=17;break;case 26:_context.next=31;break;case 28:_context.prev=28;_context.t0=_context["catch"](15);_iterator2.e(_context.t0);case 31:_context.prev=31;_iterator2.f();return _context.finish(31);case 34:_context.next=12;break;case 36:_context.next=41;break;case 38:_context.prev=38;_context.t1=_context["catch"](10);_iterator.e(_context.t1);case 41:_context.prev=41;_iterator.f();return _context.finish(41);case 44:return _context.abrupt("return",stats);case 45:case"end":return _context.stop()}}}),_callee,null,[[10,38,41,44],[15,28,31,34]])})));return _fetchMemoryUsageNodeStats.apply(this,arguments)}function memory_usage_alert_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=memory_usage_alert_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e2){didErr=true;err=_e2},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function memory_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function memory_usage_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){memory_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){memory_usage_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function memory_usage_alert_toConsumableArray(arr){return memory_usage_alert_arrayWithoutHoles(arr)||memory_usage_alert_iterableToArray(arr)||memory_usage_alert_unsupportedIterableToArray(arr)||memory_usage_alert_nonIterableSpread()}function memory_usage_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function memory_usage_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return memory_usage_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return memory_usage_alert_arrayLikeToArray(o,minLen)}function memory_usage_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function memory_usage_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return memory_usage_alert_arrayLikeToArray(arr)}function memory_usage_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function memory_usage_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function memory_usage_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function memory_usage_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)memory_usage_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)memory_usage_alert_defineProperties(Constructor,staticProps);return Constructor}function memory_usage_alert_get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){memory_usage_alert_get=Reflect.get}else{memory_usage_alert_get=function _get(target,property,receiver){var base=memory_usage_alert_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return memory_usage_alert_get(target,property,receiver||target)}function memory_usage_alert_superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=memory_usage_alert_getPrototypeOf(object);if(object===null)break}return object}function memory_usage_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)memory_usage_alert_setPrototypeOf(subClass,superClass)}function memory_usage_alert_setPrototypeOf(o,p){memory_usage_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return memory_usage_alert_setPrototypeOf(o,p)}function memory_usage_alert_createSuper(Derived){var hasNativeReflectConstruct=memory_usage_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=memory_usage_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=memory_usage_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return memory_usage_alert_possibleConstructorReturn(this,result)}}function memory_usage_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return memory_usage_alert_assertThisInitialized(self)}function memory_usage_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function memory_usage_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function memory_usage_alert_getPrototypeOf(o){memory_usage_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return memory_usage_alert_getPrototypeOf(o)}function memory_usage_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var memory_usage_alert_MemoryUsageAlert=function(_BaseAlert){memory_usage_alert_inherits(MemoryUsageAlert,_BaseAlert);var _super=memory_usage_alert_createSuper(MemoryUsageAlert);function MemoryUsageAlert(){var _this;memory_usage_alert_classCallCheck(this,MemoryUsageAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));memory_usage_alert_defineProperty(memory_usage_alert_assertThisInitialized(_this),"type",MemoryUsageAlert.TYPE);memory_usage_alert_defineProperty(memory_usage_alert_assertThisInitialized(_this),"label",MemoryUsageAlert.LABEL);memory_usage_alert_defineProperty(memory_usage_alert_assertThisInitialized(_this),"defaultParams",{threshold:85,duration:"5m"});memory_usage_alert_defineProperty(memory_usage_alert_assertThisInitialized(_this),"actionVariables",[{name:"nodes",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.actionVariables.nodes",{defaultMessage:"The list of nodes reporting high memory usage."})},{name:"count",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.actionVariables.count",{defaultMessage:"The number of nodes reporting high memory usage."})}].concat(memory_usage_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}memory_usage_alert_createClass(MemoryUsageAlert,[{key:"fetchData",value:function(){var _fetchData=memory_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var esIndexPattern,duration,threshold,parsedDuration,endMs,startMs,stats;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:esIndexPattern=appendMetricbeatIndex(this.config,constants["H"]);if(availableCcs){esIndexPattern=getCcsIndexPattern(esIndexPattern,availableCcs)}duration=params.duration,threshold=params.threshold;parsedDuration=Object(parse_duration_["parseDuration"])(duration);endMs=+new Date;startMs=endMs-parsedDuration;_context.next=8;return fetchMemoryUsageNodeStats(callCluster,clusters,esIndexPattern,startMs,endMs,this.config.ui.max_bucket_size);case 8:stats=_context.sent;return _context.abrupt("return",stats.map((function(stat){var clusterUuid=stat.clusterUuid,nodeId=stat.nodeId,memoryUsage=stat.memoryUsage,ccs=stat.ccs;return{instanceKey:"".concat(clusterUuid,":").concat(nodeId),shouldFire:memoryUsage>threshold,severity:enums["d"].Danger,meta:stat,clusterUuid:clusterUuid,ccs:ccs}})));case 10:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"filterAlertInstance",value:function filterAlertInstance(alertInstance,filters){var _alertInstance$state;var alertInstanceStates=(_alertInstance$state=alertInstance.state)===null||_alertInstance$state===void 0?void 0:_alertInstance$state.alertStates;var nodeFilter=filters===null||filters===void 0?void 0:filters.find((function(filter){return filter.nodeUuid}));if(!filters||!filters.length||!(alertInstanceStates===null||alertInstanceStates===void 0?void 0:alertInstanceStates.length)||!(nodeFilter===null||nodeFilter===void 0?void 0:nodeFilter.nodeUuid)){return true}var nodeAlerts=alertInstanceStates.filter((function(_ref){var nodeId=_ref.nodeId;return nodeId===nodeFilter.nodeUuid}));return Boolean(nodeAlerts.length)}},{key:"getDefaultAlertState",value:function getDefaultAlertState(cluster,item){var currentState=memory_usage_alert_get(memory_usage_alert_getPrototypeOf(MemoryUsageAlert.prototype),"getDefaultAlertState",this).call(this,cluster,item);currentState.ui.severity=enums["d"].Warning;return currentState}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var stat=item.meta;if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.resolvedMessage",{defaultMessage:"The JVM memory usage on node {nodeName} is now under the threshold, currently reporting at {memoryUsage}% as of #resolved",values:{nodeName:stat.nodeName,memoryUsage:stat.memoryUsage.toFixed(2)}}),tokens:[{startToken:"#resolved",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.resolvedMS}]}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.firingMessage",{defaultMessage:"Node #start_link{nodeName}#end_link is reporting JVM memory usage of {memoryUsage}% at #absolute",values:{nodeName:stat.nodeName,memoryUsage:stat.memoryUsage}}),nextSteps:[alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.nextSteps.tuneThreadPools",{defaultMessage:"#start_linkTune thread pools#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/modules-threadpool.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.nextSteps.managingHeap",{defaultMessage:"#start_linkManaging ES Heap#end_link"}),"{elasticWebsiteUrl}blog/a-heap-of-trouble"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.nextSteps.identifyIndicesShards",{defaultMessage:"#start_linkIdentify large indices/shards#end_link"}),"elasticsearch/indices",enums["b"].Link),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.nextSteps.addMoreNodes",{defaultMessage:"#start_linkAdd more data nodes#end_link"}),"{elasticWebsiteUrl}guide/en/elasticsearch/reference/{docLinkVersion}/add-elasticsearch-nodes.html"),alerts_common_createLink(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.ui.nextSteps.resizeYourDeployment",{defaultMessage:"#start_linkResize your deployment (ECE)#end_link"}),"{elasticWebsiteUrl}guide/en/cloud-enterprise/current/ece-resize-deployment.html")],tokens:[{startToken:"#absolute",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:alertState.ui.triggeredMS},{startToken:"#start_link",endToken:"#end_link",type:enums["b"].Link,url:"elasticsearch/nodes/".concat(stat.nodeId)}]}}},{key:"executeActions",value:function executeActions(instance,_ref2,item,cluster){var alertStates=_ref2.alertStates;var firingNodes=alertStates.filter((function(alertState){return alertState.ui.isFiring}));var firingCount=firingNodes.length;if(firingCount>0){var _alertStates$find;var shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.shortAction",{defaultMessage:"Verify memory usage levels across affected nodes."});var fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.fullAction",{defaultMessage:"View nodes"});var ccs=(_alertStates$find=alertStates.find((function(state){return state.ccs})))===null||_alertStates$find===void 0?void 0:_alertStates$find.ccs;var globalStateLink=this.createGlobalStateLink("elasticsearch/nodes",cluster.clusterUuid,ccs);var action="[".concat(fullActionText,"](").concat(globalStateLink,")");var internalShortMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.firing.internalShortMessage",{defaultMessage:"Memory usage alert is firing for {count} node(s) in cluster: {clusterName}. {shortActionText}",values:{count:firingCount,clusterName:cluster.clusterName,shortActionText:shortActionText}});var internalFullMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.firing.internalFullMessage",{defaultMessage:"Memory usage alert is firing for {count} node(s) in cluster: {clusterName}. {action}",values:{count:firingCount,clusterName:cluster.clusterName,action:action}});instance.scheduleActions("default",{internalShortMessage:internalShortMessage,internalFullMessage:this.isCloud?internalShortMessage:internalFullMessage,state:AlertingDefaults.ALERT_STATE.firing,nodes:firingNodes.map((function(state){return"".concat(state.nodeName,":").concat(state.memoryUsage.toFixed(2))})).join(","),count:firingCount,clusterName:cluster.clusterName,action:action,actionPlain:shortActionText})}else{var resolvedNodes=alertStates.filter((function(state){return!state.ui.isFiring})).map((function(state){return"".concat(state.nodeName,":").concat(state.memoryUsage.toFixed(2))}));var resolvedCount=resolvedNodes.length;if(resolvedCount>0){var internalMessage=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.resolved.internalMessage",{defaultMessage:"Memory usage alert is resolved for {count} node(s) in cluster: {clusterName}.",values:{count:resolvedCount,clusterName:cluster.clusterName}});instance.scheduleActions("default",{internalShortMessage:internalMessage,internalFullMessage:internalMessage,state:AlertingDefaults.ALERT_STATE.resolved,nodes:resolvedNodes.join(","),count:resolvedCount,clusterName:cluster.clusterName})}}}},{key:"processData",value:function(){var _processData=memory_usage_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(data,clusters,services,logger,state){var _this2=this;var currentUTC,_iterator,_step,_loop,_ret;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:currentUTC=+new Date;_iterator=memory_usage_alert_createForOfIteratorHelper(clusters);_context2.prev=2;_loop=function _loop(){var cluster=_step.value;var nodes=data.filter((function(node){return node.clusterUuid===cluster.clusterUuid}));if(!nodes.length){return"continue"}var firingNodeUuids=nodes.filter((function(node){return node.shouldFire})).map((function(node){return node.meta.nodeId})).join(",");var instanceId="".concat(_this2.type,":").concat(cluster.clusterUuid,":").concat(firingNodeUuids);var instance=services.alertInstanceFactory(instanceId);var newAlertStates=[];var _iterator2=memory_usage_alert_createForOfIteratorHelper(nodes),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var node=_step2.value;var stat=node.meta;var nodeState=_this2.getDefaultAlertState(cluster,node);nodeState.memoryUsage=stat.memoryUsage;nodeState.nodeId=stat.nodeId;nodeState.nodeName=stat.nodeName;if(node.shouldFire){nodeState.ui.triggeredMS=currentUTC;nodeState.ui.isFiring=true;nodeState.ui.severity=node.severity;newAlertStates.push(nodeState)}nodeState.ui.message=_this2.getUiMessage(nodeState,node)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}var alertInstanceState={alertStates:newAlertStates};instance.replaceState(alertInstanceState);if(newAlertStates.length){_this2.executeActions(instance,alertInstanceState,null,cluster);state.lastExecutedAction=currentUTC}};_iterator.s();case 5:if((_step=_iterator.n()).done){_context2.next=11;break}_ret=_loop();if(!(_ret==="continue")){_context2.next=9;break}return _context2.abrupt("continue",9);case 9:_context2.next=5;break;case 11:_context2.next=16;break;case 13:_context2.prev=13;_context2.t0=_context2["catch"](2);_iterator.e(_context2.t0);case 16:_context2.prev=16;_iterator.f();return _context2.finish(16);case 19:state.lastChecked=currentUTC;return _context2.abrupt("return",state);case 21:case"end":return _context2.stop()}}}),_callee2,null,[[2,13,16,19]])})));function processData(_x6,_x7,_x8,_x9,_x10){return _processData.apply(this,arguments)}return processData}()}]);return MemoryUsageAlert}(base_alert_BaseAlert);memory_usage_alert_defineProperty(memory_usage_alert_MemoryUsageAlert,"PARAM_DETAILS",{threshold:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.paramDetails.threshold.label",{defaultMessage:"Notify when memory usage is over"}),type:enums["c"].Percentage},duration:{label:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.paramDetails.duration.label",{defaultMessage:"Look at the average over"}),type:enums["c"].Duration}});memory_usage_alert_defineProperty(memory_usage_alert_MemoryUsageAlert,"paramDetails",memory_usage_alert_MemoryUsageAlert.PARAM_DETAILS);memory_usage_alert_defineProperty(memory_usage_alert_MemoryUsageAlert,"TYPE",constants["h"]);memory_usage_alert_defineProperty(memory_usage_alert_MemoryUsageAlert,"LABEL",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.memoryUsage.label",{defaultMessage:"Memory Usage (JVM)"}));function fetch_legacy_alerts_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function fetch_legacy_alerts_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){fetch_legacy_alerts_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){fetch_legacy_alerts_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function fetchLegacyAlerts(_x,_x2,_x3,_x4,_x5){return _fetchLegacyAlerts.apply(this,arguments)}function _fetchLegacyAlerts(){_fetchLegacyAlerts=fetch_legacy_alerts_asyncToGenerator(regeneratorRuntime.mark((function _callee(callCluster,clusters,index,watchName,size){var params,response;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:params={index:index,filterPath:["hits.hits._source.prefix","hits.hits._source.message","hits.hits._source.resolved_timestamp","hits.hits._source.nodes","hits.hits._source.metadata.*"],body:{size:size,sort:[{timestamp:{order:"desc"}}],query:{bool:{minimum_should_match:1,filter:[{terms:{"metadata.cluster_uuid":clusters.map((function(cluster){return cluster.clusterUuid}))}},{term:{"metadata.watch":watchName}}],should:[{range:{timestamp:{gte:"now-2m"}}},{range:{resolved_timestamp:{gte:"now-2m"}}},{bool:{must_not:{exists:{field:"resolved_timestamp"}}}}]}},collapse:{field:"metadata.cluster_uuid"}}};_context.next=3;return callCluster("search",params);case 3:response=_context.sent;return _context.abrupt("return",Object(external_kbnSharedDeps_Lodash_["get"])(response,"hits.hits",[]).map((function(hit){var legacyAlert={prefix:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.prefix"),message:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.message"),resolved_timestamp:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.resolved_timestamp"),nodes:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.nodes"),metadata:Object(external_kbnSharedDeps_Lodash_["get"])(hit,"_source.metadata")};return legacyAlert})));case 5:case"end":return _context.stop()}}}),_callee)})));return _fetchLegacyAlerts.apply(this,arguments)}function mapLegacySeverity(severity){var floor=Math.floor(severity/1e3);if(floor<=1){return enums["d"].Warning}return enums["d"].Danger}function cluster_health_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function cluster_health_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){cluster_health_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){cluster_health_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function cluster_health_alert_toConsumableArray(arr){return cluster_health_alert_arrayWithoutHoles(arr)||cluster_health_alert_iterableToArray(arr)||cluster_health_alert_unsupportedIterableToArray(arr)||cluster_health_alert_nonIterableSpread()}function cluster_health_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function cluster_health_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return cluster_health_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cluster_health_alert_arrayLikeToArray(o,minLen)}function cluster_health_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function cluster_health_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return cluster_health_alert_arrayLikeToArray(arr)}function cluster_health_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function cluster_health_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function cluster_health_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function cluster_health_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)cluster_health_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)cluster_health_alert_defineProperties(Constructor,staticProps);return Constructor}function cluster_health_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)cluster_health_alert_setPrototypeOf(subClass,superClass)}function cluster_health_alert_setPrototypeOf(o,p){cluster_health_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return cluster_health_alert_setPrototypeOf(o,p)}function cluster_health_alert_createSuper(Derived){var hasNativeReflectConstruct=cluster_health_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=cluster_health_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=cluster_health_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return cluster_health_alert_possibleConstructorReturn(this,result)}}function cluster_health_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return cluster_health_alert_assertThisInitialized(self)}function cluster_health_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function cluster_health_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function cluster_health_alert_getPrototypeOf(o){cluster_health_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return cluster_health_alert_getPrototypeOf(o)}function cluster_health_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var RED_STATUS_MESSAGE=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.redMessage",{defaultMessage:"Allocate missing primary and replica shards"});var YELLOW_STATUS_MESSAGE=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.yellowMessage",{defaultMessage:"Allocate missing replica shards"});var WATCH_NAME="elasticsearch_cluster_status";var cluster_health_alert_ClusterHealthAlert=function(_BaseAlert){cluster_health_alert_inherits(ClusterHealthAlert,_BaseAlert);var _super=cluster_health_alert_createSuper(ClusterHealthAlert);function ClusterHealthAlert(){var _this;cluster_health_alert_classCallCheck(this,ClusterHealthAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));cluster_health_alert_defineProperty(cluster_health_alert_assertThisInitialized(_this),"type",constants["a"]);cluster_health_alert_defineProperty(cluster_health_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.label",{defaultMessage:"Cluster health"}));cluster_health_alert_defineProperty(cluster_health_alert_assertThisInitialized(_this),"isLegacy",true);cluster_health_alert_defineProperty(cluster_health_alert_assertThisInitialized(_this),"actionVariables",[{name:"clusterHealth",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.actionVariables.clusterHealth",{defaultMessage:"The health of the cluster."})}].concat(cluster_health_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}cluster_health_alert_createClass(ClusterHealthAlert,[{key:"fetchData",value:function(){var _fetchData=cluster_health_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:!legacyAlert.resolved_timestamp,severity:mapLegacySeverity(legacyAlert.metadata.severity),meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getHealth",value:function getHealth(legacyAlert){var prefixStr="Elasticsearch cluster status is ";return legacyAlert.prefix.slice(legacyAlert.prefix.indexOf(prefixStr)+prefixStr.length,legacyAlert.prefix.length-1)}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;var health=this.getHealth(legacyAlert);if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.ui.resolvedMessage",{defaultMessage:"Elasticsearch cluster health is green."})}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.ui.firingMessage",{defaultMessage:"Elasticsearch cluster health is {health}.",values:{health:health}}),nextSteps:[{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.ui.nextSteps.message1",{defaultMessage:"{message}. #start_linkView now#end_link",values:{message:health===enums["a"].Red?RED_STATUS_MESSAGE:YELLOW_STATUS_MESSAGE}}),tokens:[{startToken:"#start_link",endToken:"#end_link",type:enums["b"].Link,url:"elasticsearch/indices"}]}]}}},{key:"executeActions",value:function(){var _executeActions=cluster_health_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,health,actionText,action;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;health=this.getHealth(legacyAlert);if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.resolved.internalShortMessage",{defaultMessage:"Cluster health alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.resolved.internalFullMessage",{defaultMessage:"Cluster health alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,clusterHealth:health,clusterName:cluster.clusterName})}else{actionText=health===enums["a"].Red?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.action.danger",{defaultMessage:"Allocate missing primary and replica shards."}):external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.action.warning",{defaultMessage:"Allocate missing replica shards."});action="[".concat(actionText,"](elasticsearch/indices)");instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.firing.internalShortMessage",{defaultMessage:"Cluster health alert is firing for {clusterName}. Current health is {health}. {actionText}",values:{clusterName:cluster.clusterName,health:health,actionText:actionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.clusterHealth.firing.internalFullMessage",{defaultMessage:"Cluster health alert is firing for {clusterName}. Current health is {health}. {action}",values:{clusterName:cluster.clusterName,health:health,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,clusterHealth:health,clusterName:cluster.clusterName,action:action,actionPlain:actionText})}case 6:case"end":return _context2.stop()}}}),_callee2,this)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return ClusterHealthAlert}(base_alert_BaseAlert);function license_expiration_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function license_expiration_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){license_expiration_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){license_expiration_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function license_expiration_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function license_expiration_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function license_expiration_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)license_expiration_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)license_expiration_alert_defineProperties(Constructor,staticProps);return Constructor}function license_expiration_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)license_expiration_alert_setPrototypeOf(subClass,superClass)}function license_expiration_alert_setPrototypeOf(o,p){license_expiration_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return license_expiration_alert_setPrototypeOf(o,p)}function license_expiration_alert_createSuper(Derived){var hasNativeReflectConstruct=license_expiration_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=license_expiration_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=license_expiration_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return license_expiration_alert_possibleConstructorReturn(this,result)}}function license_expiration_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return license_expiration_alert_assertThisInitialized(self)}function license_expiration_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function license_expiration_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function license_expiration_alert_getPrototypeOf(o){license_expiration_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return license_expiration_alert_getPrototypeOf(o)}function license_expiration_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var license_expiration_alert_WATCH_NAME="xpack_license_expiration";var license_expiration_alert_LicenseExpirationAlert=function(_BaseAlert){license_expiration_alert_inherits(LicenseExpirationAlert,_BaseAlert);var _super=license_expiration_alert_createSuper(LicenseExpirationAlert);function LicenseExpirationAlert(){var _this;license_expiration_alert_classCallCheck(this,LicenseExpirationAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));license_expiration_alert_defineProperty(license_expiration_alert_assertThisInitialized(_this),"type",constants["f"]);license_expiration_alert_defineProperty(license_expiration_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.label",{defaultMessage:"License expiration"}));license_expiration_alert_defineProperty(license_expiration_alert_assertThisInitialized(_this),"isLegacy",true);license_expiration_alert_defineProperty(license_expiration_alert_assertThisInitialized(_this),"actionVariables",[{name:"expiredDate",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.actionVariables.expiredDate",{defaultMessage:"The date when the license expires."})},{name:"clusterName",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.actionVariables.clusterName",{defaultMessage:"The cluster to which the license belong."})},AlertingDefaults.ALERT_TYPE.context.internalShortMessage,AlertingDefaults.ALERT_TYPE.context.internalFullMessage,AlertingDefaults.ALERT_TYPE.context.state,AlertingDefaults.ALERT_TYPE.context.action,AlertingDefaults.ALERT_TYPE.context.actionPlain]);return _this}license_expiration_alert_createClass(LicenseExpirationAlert,[{key:"fetchData",value:function(){var _fetchData=license_expiration_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,license_expiration_alert_WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:!legacyAlert.resolved_timestamp,severity:mapLegacySeverity(legacyAlert.metadata.severity),meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.ui.resolvedMessage",{defaultMessage:"The license for this cluster is active."})}}return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.ui.firingMessage",{defaultMessage:"The license for this cluster expires in #relative at #absolute. #start_linkPlease update your license.#end_link"}),tokens:[{startToken:"#relative",type:enums["b"].Time,isRelative:true,isAbsolute:false,timestamp:legacyAlert.metadata.time},{startToken:"#absolute",type:enums["b"].Time,isAbsolute:true,isRelative:false,timestamp:legacyAlert.metadata.time},{startToken:"#start_link",endToken:"#end_link",type:enums["b"].Link,url:"license"}]}}},{key:"executeActions",value:function(){var _executeActions=license_expiration_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,$expiry,actionText,action,expiredDate;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;$expiry=external_kbnSharedDeps_Moment_default()(legacyAlert.metadata.time);if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.resolved.internalShortMessage",{defaultMessage:"License expiration alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.resolved.internalFullMessage",{defaultMessage:"License expiration alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,expiredDate:$expiry.format(constants["D"]).trim(),clusterName:cluster.clusterName})}else{actionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.action",{defaultMessage:"Please update your license."});action="[".concat(actionText,"](elasticsearch/nodes)");expiredDate=$expiry.format(constants["D"]).trim();instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.firing.internalShortMessage",{defaultMessage:"License expiration alert is firing for {clusterName}. Your license expires in {expiredDate}. {actionText}",values:{clusterName:cluster.clusterName,expiredDate:expiredDate,actionText:actionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.licenseExpiration.firing.internalFullMessage",{defaultMessage:"License expiration alert is firing for {clusterName}. Your license expires in {expiredDate}. {action}",values:{clusterName:cluster.clusterName,expiredDate:expiredDate,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,expiredDate:expiredDate,clusterName:cluster.clusterName,action:action,actionPlain:actionText})}case 6:case"end":return _context2.stop()}}}),_callee2)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return LicenseExpirationAlert}(base_alert_BaseAlert);function nodes_changed_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function nodes_changed_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){nodes_changed_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){nodes_changed_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function nodes_changed_alert_toConsumableArray(arr){return nodes_changed_alert_arrayWithoutHoles(arr)||nodes_changed_alert_iterableToArray(arr)||nodes_changed_alert_unsupportedIterableToArray(arr)||nodes_changed_alert_nonIterableSpread()}function nodes_changed_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function nodes_changed_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return nodes_changed_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nodes_changed_alert_arrayLikeToArray(o,minLen)}function nodes_changed_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function nodes_changed_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return nodes_changed_alert_arrayLikeToArray(arr)}function nodes_changed_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function nodes_changed_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function nodes_changed_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function nodes_changed_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)nodes_changed_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)nodes_changed_alert_defineProperties(Constructor,staticProps);return Constructor}function nodes_changed_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)nodes_changed_alert_setPrototypeOf(subClass,superClass)}function nodes_changed_alert_setPrototypeOf(o,p){nodes_changed_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return nodes_changed_alert_setPrototypeOf(o,p)}function nodes_changed_alert_createSuper(Derived){var hasNativeReflectConstruct=nodes_changed_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=nodes_changed_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=nodes_changed_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return nodes_changed_alert_possibleConstructorReturn(this,result)}}function nodes_changed_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return nodes_changed_alert_assertThisInitialized(self)}function nodes_changed_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function nodes_changed_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function nodes_changed_alert_getPrototypeOf(o){nodes_changed_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return nodes_changed_alert_getPrototypeOf(o)}function nodes_changed_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var nodes_changed_alert_WATCH_NAME="elasticsearch_nodes";var nodes_changed_alert_NodesChangedAlert=function(_BaseAlert){nodes_changed_alert_inherits(NodesChangedAlert,_BaseAlert);var _super=nodes_changed_alert_createSuper(NodesChangedAlert);function NodesChangedAlert(){var _this;nodes_changed_alert_classCallCheck(this,NodesChangedAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));nodes_changed_alert_defineProperty(nodes_changed_alert_assertThisInitialized(_this),"type",constants["j"]);nodes_changed_alert_defineProperty(nodes_changed_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.label",{defaultMessage:"Nodes changed"}));nodes_changed_alert_defineProperty(nodes_changed_alert_assertThisInitialized(_this),"isLegacy",true);nodes_changed_alert_defineProperty(nodes_changed_alert_assertThisInitialized(_this),"actionVariables",[{name:"added",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.actionVariables.added",{defaultMessage:"The list of nodes added to the cluster."})},{name:"removed",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.actionVariables.removed",{defaultMessage:"The list of nodes removed from the cluster."})},{name:"restarted",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.actionVariables.restarted",{defaultMessage:"The list of nodes restarted in the cluster."})}].concat(nodes_changed_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}nodes_changed_alert_createClass(NodesChangedAlert,[{key:"getNodeStates",value:function getNodeStates(legacyAlert){return legacyAlert.nodes}},{key:"fetchData",value:function(){var _fetchData=nodes_changed_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,nodes_changed_alert_WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:true,severity:mapLegacySeverity(legacyAlert.metadata.severity),meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;var states=this.getNodeStates(legacyAlert)||{added:{},removed:{},restarted:{}};if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.ui.resolvedMessage",{defaultMessage:"No changes in Elasticsearch nodes for this cluster."})}}if(Object.values(states.added).length===0&&Object.values(states.removed).length===0&&Object.values(states.restarted).length===0){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.ui.nothingDetectedFiringMessage",{defaultMessage:"Elasticsearch nodes have changed"})}}var addedText=Object.values(states.added).length>0?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.ui.addedFiringMessage",{defaultMessage:"Elasticsearch nodes '{added}' added to this cluster.",values:{added:Object.values(states.added).join(",")}}):null;var removedText=Object.values(states.removed).length>0?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.ui.removedFiringMessage",{defaultMessage:"Elasticsearch nodes '{removed}' removed from this cluster.",values:{removed:Object.values(states.removed).join(",")}}):null;var restartedText=Object.values(states.restarted).length>0?external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.ui.restartedFiringMessage",{defaultMessage:"Elasticsearch nodes '{restarted}' restarted in this cluster.",values:{restarted:Object.values(states.restarted).join(",")}}):null;return{text:[addedText,removedText,restartedText].filter(Boolean).join(" ")}}},{key:"executeActions",value:function(){var _executeActions=nodes_changed_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,shortActionText,fullActionText,action,states,added,removed,restarted;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.resolved.internalShortMessage",{defaultMessage:"Elasticsearch nodes changed alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.resolved.internalFullMessage",{defaultMessage:"Elasticsearch nodes changed alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,clusterName:cluster.clusterName})}else{shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.shortAction",{defaultMessage:"Verify that you added, removed, or restarted nodes."});fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.fullAction",{defaultMessage:"View nodes"});action="[".concat(fullActionText,"](elasticsearch/nodes)");states=this.getNodeStates(legacyAlert)||{added:{},removed:{},restarted:{}};added=Object.values(states.added).join(",");removed=Object.values(states.removed).join(",");restarted=Object.values(states.restarted).join(",");instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.firing.internalShortMessage",{defaultMessage:"Nodes changed alert is firing for {clusterName}. {shortActionText}",values:{clusterName:cluster.clusterName,shortActionText:shortActionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.nodesChanged.firing.internalFullMessage",{defaultMessage:"Nodes changed alert is firing for {clusterName}. The following Elasticsearch nodes have been added:{added} removed:{removed} restarted:{restarted}. {action}",values:{clusterName:cluster.clusterName,added:added,removed:removed,restarted:restarted,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,clusterName:cluster.clusterName,added:added,removed:removed,restarted:restarted,action:action,actionPlain:shortActionText})}case 5:case"end":return _context2.stop()}}}),_callee2,this)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return NodesChangedAlert}(base_alert_BaseAlert);function elasticsearch_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function elasticsearch_version_mismatch_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){elasticsearch_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){elasticsearch_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function elasticsearch_version_mismatch_alert_toConsumableArray(arr){return elasticsearch_version_mismatch_alert_arrayWithoutHoles(arr)||elasticsearch_version_mismatch_alert_iterableToArray(arr)||elasticsearch_version_mismatch_alert_unsupportedIterableToArray(arr)||elasticsearch_version_mismatch_alert_nonIterableSpread()}function elasticsearch_version_mismatch_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function elasticsearch_version_mismatch_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return elasticsearch_version_mismatch_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return elasticsearch_version_mismatch_alert_arrayLikeToArray(o,minLen)}function elasticsearch_version_mismatch_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function elasticsearch_version_mismatch_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return elasticsearch_version_mismatch_alert_arrayLikeToArray(arr)}function elasticsearch_version_mismatch_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function elasticsearch_version_mismatch_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function elasticsearch_version_mismatch_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function elasticsearch_version_mismatch_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)elasticsearch_version_mismatch_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)elasticsearch_version_mismatch_alert_defineProperties(Constructor,staticProps);return Constructor}function elasticsearch_version_mismatch_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)elasticsearch_version_mismatch_alert_setPrototypeOf(subClass,superClass)}function elasticsearch_version_mismatch_alert_setPrototypeOf(o,p){elasticsearch_version_mismatch_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return elasticsearch_version_mismatch_alert_setPrototypeOf(o,p)}function elasticsearch_version_mismatch_alert_createSuper(Derived){var hasNativeReflectConstruct=elasticsearch_version_mismatch_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=elasticsearch_version_mismatch_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=elasticsearch_version_mismatch_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return elasticsearch_version_mismatch_alert_possibleConstructorReturn(this,result)}}function elasticsearch_version_mismatch_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return elasticsearch_version_mismatch_alert_assertThisInitialized(self)}function elasticsearch_version_mismatch_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function elasticsearch_version_mismatch_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function elasticsearch_version_mismatch_alert_getPrototypeOf(o){elasticsearch_version_mismatch_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return elasticsearch_version_mismatch_alert_getPrototypeOf(o)}function elasticsearch_version_mismatch_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var elasticsearch_version_mismatch_alert_WATCH_NAME="elasticsearch_version_mismatch";var elasticsearch_version_mismatch_alert_ElasticsearchVersionMismatchAlert=function(_BaseAlert){elasticsearch_version_mismatch_alert_inherits(ElasticsearchVersionMismatchAlert,_BaseAlert);var _super=elasticsearch_version_mismatch_alert_createSuper(ElasticsearchVersionMismatchAlert);function ElasticsearchVersionMismatchAlert(){var _this;elasticsearch_version_mismatch_alert_classCallCheck(this,ElasticsearchVersionMismatchAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));elasticsearch_version_mismatch_alert_defineProperty(elasticsearch_version_mismatch_alert_assertThisInitialized(_this),"type",constants["d"]);elasticsearch_version_mismatch_alert_defineProperty(elasticsearch_version_mismatch_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.label",{defaultMessage:"Elasticsearch version mismatch"}));elasticsearch_version_mismatch_alert_defineProperty(elasticsearch_version_mismatch_alert_assertThisInitialized(_this),"isLegacy",true);elasticsearch_version_mismatch_alert_defineProperty(elasticsearch_version_mismatch_alert_assertThisInitialized(_this),"actionVariables",[{name:"versionList",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.actionVariables.clusterHealth",{defaultMessage:"The versions of Elasticsearch running in this cluster."})}].concat(elasticsearch_version_mismatch_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}elasticsearch_version_mismatch_alert_createClass(ElasticsearchVersionMismatchAlert,[{key:"fetchData",value:function(){var _fetchData=elasticsearch_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,elasticsearch_version_mismatch_alert_WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){var severity=enums["d"].Warning;accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:!legacyAlert.resolved_timestamp,severity:severity,meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getVersions",value:function getVersions(legacyAlert){var prefixStr="Versions: ";return legacyAlert.message.slice(legacyAlert.message.indexOf(prefixStr)+prefixStr.length,legacyAlert.message.length-1)}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;var versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.ui.resolvedMessage",{defaultMessage:"All versions of Elasticsearch are the same in this cluster."})}}var text=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.ui.firingMessage",{defaultMessage:"Multiple versions of Elasticsearch ({versions}) running in this cluster.",values:{versions:versions}});return{text:text}}},{key:"executeActions",value:function(){var _executeActions=elasticsearch_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,versions,shortActionText,fullActionText,action;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.resolved.internalShortMessage",{defaultMessage:"Elasticsearch version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.resolved.internalFullMessage",{defaultMessage:"Elasticsearch version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,clusterName:cluster.clusterName})}else{shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.shortAction",{defaultMessage:"Verify you have the same version across all nodes."});fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.fullAction",{defaultMessage:"View nodes"});action="[".concat(fullActionText,"](elasticsearch/nodes)");instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.firing.internalShortMessage",{defaultMessage:"Elasticsearch version mismatch alert is firing for {clusterName}. {shortActionText}",values:{clusterName:cluster.clusterName,shortActionText:shortActionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.elasticsearchVersionMismatch.firing.internalFullMessage",{defaultMessage:"Elasticsearch version mismatch alert is firing for {clusterName}. Elasticsearch is running {versions}. {action}",values:{clusterName:cluster.clusterName,versions:versions,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,clusterName:cluster.clusterName,versionList:versions,action:action,actionPlain:shortActionText})}case 6:case"end":return _context2.stop()}}}),_callee2,this)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return ElasticsearchVersionMismatchAlert}(base_alert_BaseAlert);function kibana_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function kibana_version_mismatch_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){kibana_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){kibana_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function kibana_version_mismatch_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function kibana_version_mismatch_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function kibana_version_mismatch_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)kibana_version_mismatch_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)kibana_version_mismatch_alert_defineProperties(Constructor,staticProps);return Constructor}function kibana_version_mismatch_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)kibana_version_mismatch_alert_setPrototypeOf(subClass,superClass)}function kibana_version_mismatch_alert_setPrototypeOf(o,p){kibana_version_mismatch_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return kibana_version_mismatch_alert_setPrototypeOf(o,p)}function kibana_version_mismatch_alert_createSuper(Derived){var hasNativeReflectConstruct=kibana_version_mismatch_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=kibana_version_mismatch_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=kibana_version_mismatch_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return kibana_version_mismatch_alert_possibleConstructorReturn(this,result)}}function kibana_version_mismatch_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return kibana_version_mismatch_alert_assertThisInitialized(self)}function kibana_version_mismatch_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function kibana_version_mismatch_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function kibana_version_mismatch_alert_getPrototypeOf(o){kibana_version_mismatch_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return kibana_version_mismatch_alert_getPrototypeOf(o)}function kibana_version_mismatch_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var kibana_version_mismatch_alert_WATCH_NAME="kibana_version_mismatch";var kibana_version_mismatch_alert_KibanaVersionMismatchAlert=function(_BaseAlert){kibana_version_mismatch_alert_inherits(KibanaVersionMismatchAlert,_BaseAlert);var _super=kibana_version_mismatch_alert_createSuper(KibanaVersionMismatchAlert);function KibanaVersionMismatchAlert(){var _this;kibana_version_mismatch_alert_classCallCheck(this,KibanaVersionMismatchAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));kibana_version_mismatch_alert_defineProperty(kibana_version_mismatch_alert_assertThisInitialized(_this),"type",constants["e"]);kibana_version_mismatch_alert_defineProperty(kibana_version_mismatch_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.label",{defaultMessage:"Kibana version mismatch"}));kibana_version_mismatch_alert_defineProperty(kibana_version_mismatch_alert_assertThisInitialized(_this),"isLegacy",true);kibana_version_mismatch_alert_defineProperty(kibana_version_mismatch_alert_assertThisInitialized(_this),"actionVariables",[{name:"versionList",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.actionVariables.clusterHealth",{defaultMessage:"The versions of Kibana running in this cluster."})},{name:"clusterName",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.actionVariables.clusterName",{defaultMessage:"The cluster to which the instances belong."})},AlertingDefaults.ALERT_TYPE.context.internalShortMessage,AlertingDefaults.ALERT_TYPE.context.internalFullMessage,AlertingDefaults.ALERT_TYPE.context.state,AlertingDefaults.ALERT_TYPE.context.action,AlertingDefaults.ALERT_TYPE.context.actionPlain]);return _this}kibana_version_mismatch_alert_createClass(KibanaVersionMismatchAlert,[{key:"fetchData",value:function(){var _fetchData=kibana_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,kibana_version_mismatch_alert_WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){var severity=enums["d"].Warning;accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:!legacyAlert.resolved_timestamp,severity:severity,meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getVersions",value:function getVersions(legacyAlert){var prefixStr="Versions: ";return legacyAlert.message.slice(legacyAlert.message.indexOf(prefixStr)+prefixStr.length,legacyAlert.message.length-1)}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;var versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.ui.resolvedMessage",{defaultMessage:"All versions of Kibana are the same in this cluster."})}}var text=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.ui.firingMessage",{defaultMessage:"Multiple versions of Kibana ({versions}) running in this cluster.",values:{versions:versions}});return{text:text}}},{key:"executeActions",value:function(){var _executeActions=kibana_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,versions,shortActionText,fullActionText,action;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.resolved.internalShortMessage",{defaultMessage:"Kibana version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.resolved.internalFullMessage",{defaultMessage:"Kibana version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,clusterName:cluster.clusterName})}else{shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.shortAction",{defaultMessage:"Verify you have the same version across all instances."});fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.fullAction",{defaultMessage:"View instances"});action="[".concat(fullActionText,"](kibana/instances)");instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.firing.internalShortMessage",{defaultMessage:"Kibana version mismatch alert is firing for {clusterName}. {shortActionText}",values:{clusterName:cluster.clusterName,shortActionText:shortActionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.kibanaVersionMismatch.firing.internalFullMessage",{defaultMessage:"Kibana version mismatch alert is firing for {clusterName}. Kibana is running {versions}. {action}",values:{clusterName:cluster.clusterName,versions:versions,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,clusterName:cluster.clusterName,versionList:versions,action:action,actionPlain:shortActionText})}case 6:case"end":return _context2.stop()}}}),_callee2,this)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return KibanaVersionMismatchAlert}(base_alert_BaseAlert);function logstash_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function logstash_version_mismatch_alert_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){logstash_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){logstash_version_mismatch_alert_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function logstash_version_mismatch_alert_toConsumableArray(arr){return logstash_version_mismatch_alert_arrayWithoutHoles(arr)||logstash_version_mismatch_alert_iterableToArray(arr)||logstash_version_mismatch_alert_unsupportedIterableToArray(arr)||logstash_version_mismatch_alert_nonIterableSpread()}function logstash_version_mismatch_alert_nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function logstash_version_mismatch_alert_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return logstash_version_mismatch_alert_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return logstash_version_mismatch_alert_arrayLikeToArray(o,minLen)}function logstash_version_mismatch_alert_iterableToArray(iter){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(iter))return Array.from(iter)}function logstash_version_mismatch_alert_arrayWithoutHoles(arr){if(Array.isArray(arr))return logstash_version_mismatch_alert_arrayLikeToArray(arr)}function logstash_version_mismatch_alert_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function logstash_version_mismatch_alert_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function logstash_version_mismatch_alert_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function logstash_version_mismatch_alert_createClass(Constructor,protoProps,staticProps){if(protoProps)logstash_version_mismatch_alert_defineProperties(Constructor.prototype,protoProps);if(staticProps)logstash_version_mismatch_alert_defineProperties(Constructor,staticProps);return Constructor}function logstash_version_mismatch_alert_inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)logstash_version_mismatch_alert_setPrototypeOf(subClass,superClass)}function logstash_version_mismatch_alert_setPrototypeOf(o,p){logstash_version_mismatch_alert_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return logstash_version_mismatch_alert_setPrototypeOf(o,p)}function logstash_version_mismatch_alert_createSuper(Derived){var hasNativeReflectConstruct=logstash_version_mismatch_alert_isNativeReflectConstruct();return function _createSuperInternal(){var Super=logstash_version_mismatch_alert_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=logstash_version_mismatch_alert_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return logstash_version_mismatch_alert_possibleConstructorReturn(this,result)}}function logstash_version_mismatch_alert_possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return logstash_version_mismatch_alert_assertThisInitialized(self)}function logstash_version_mismatch_alert_assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function logstash_version_mismatch_alert_isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],(function(){})));return true}catch(e){return false}}function logstash_version_mismatch_alert_getPrototypeOf(o){logstash_version_mismatch_alert_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return logstash_version_mismatch_alert_getPrototypeOf(o)}function logstash_version_mismatch_alert_defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var logstash_version_mismatch_alert_WATCH_NAME="logstash_version_mismatch";var logstash_version_mismatch_alert_LogstashVersionMismatchAlert=function(_BaseAlert){logstash_version_mismatch_alert_inherits(LogstashVersionMismatchAlert,_BaseAlert);var _super=logstash_version_mismatch_alert_createSuper(LogstashVersionMismatchAlert);function LogstashVersionMismatchAlert(){var _this;logstash_version_mismatch_alert_classCallCheck(this,LogstashVersionMismatchAlert);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_this=_super.call.apply(_super,[this].concat(args));logstash_version_mismatch_alert_defineProperty(logstash_version_mismatch_alert_assertThisInitialized(_this),"type",constants["g"]);logstash_version_mismatch_alert_defineProperty(logstash_version_mismatch_alert_assertThisInitialized(_this),"label",external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.label",{defaultMessage:"Logstash version mismatch"}));logstash_version_mismatch_alert_defineProperty(logstash_version_mismatch_alert_assertThisInitialized(_this),"isLegacy",true);logstash_version_mismatch_alert_defineProperty(logstash_version_mismatch_alert_assertThisInitialized(_this),"actionVariables",[{name:"versionList",description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.actionVariables.clusterHealth",{defaultMessage:"The versions of Logstash running in this cluster."})}].concat(logstash_version_mismatch_alert_toConsumableArray(Object.values(AlertingDefaults.ALERT_TYPE.context))));return _this}logstash_version_mismatch_alert_createClass(LogstashVersionMismatchAlert,[{key:"fetchData",value:function(){var _fetchData=logstash_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee(params,callCluster,clusters,uiSettings,availableCcs){var alertIndexPattern,legacyAlerts;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertIndexPattern=constants["F"];if(availableCcs){alertIndexPattern=getCcsIndexPattern(alertIndexPattern,availableCcs)}_context.next=4;return fetchLegacyAlerts(callCluster,clusters,alertIndexPattern,logstash_version_mismatch_alert_WATCH_NAME,this.config.ui.max_bucket_size);case 4:legacyAlerts=_context.sent;return _context.abrupt("return",legacyAlerts.reduce((function(accum,legacyAlert){var severity=enums["d"].Warning;accum.push({instanceKey:"".concat(legacyAlert.metadata.cluster_uuid),clusterUuid:legacyAlert.metadata.cluster_uuid,shouldFire:!legacyAlert.resolved_timestamp,severity:severity,meta:legacyAlert});return accum}),[]));case 6:case"end":return _context.stop()}}}),_callee,this)})));function fetchData(_x,_x2,_x3,_x4,_x5){return _fetchData.apply(this,arguments)}return fetchData}()},{key:"getVersions",value:function getVersions(legacyAlert){var prefixStr="Versions: ";return legacyAlert.message.slice(legacyAlert.message.indexOf(prefixStr)+prefixStr.length,legacyAlert.message.length-1)}},{key:"getUiMessage",value:function getUiMessage(alertState,item){var legacyAlert=item.meta;var versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){return{text:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.ui.resolvedMessage",{defaultMessage:"All versions of Logstash are the same in this cluster."})}}var text=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.ui.firingMessage",{defaultMessage:"Multiple versions of Logstash ({versions}) running in this cluster.",values:{versions:versions}});return{text:text}}},{key:"executeActions",value:function(){var _executeActions=logstash_version_mismatch_alert_asyncToGenerator(regeneratorRuntime.mark((function _callee2(instance,instanceState,item,cluster){var alertState,legacyAlert,versions,shortActionText,fullActionText,action;return regeneratorRuntime.wrap((function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!(instanceState.alertStates.length===0)){_context2.next=2;break}return _context2.abrupt("return");case 2:alertState=instanceState.alertStates[0];legacyAlert=item.meta;versions=this.getVersions(legacyAlert);if(!alertState.ui.isFiring){instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.resolved.internalShortMessage",{defaultMessage:"Logstash version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.resolved.internalFullMessage",{defaultMessage:"Logstash version mismatch alert is resolved for {clusterName}.",values:{clusterName:cluster.clusterName}}),state:AlertingDefaults.ALERT_STATE.resolved,clusterName:cluster.clusterName})}else{shortActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.shortAction",{defaultMessage:"Verify you have the same version across all nodes."});fullActionText=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.fullAction",{defaultMessage:"View nodes"});action="[".concat(fullActionText,"](logstash/nodes)");instance.scheduleActions("default",{internalShortMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.firing.internalShortMessage",{defaultMessage:"Logstash version mismatch alert is firing for {clusterName}. {shortActionText}",values:{clusterName:cluster.clusterName,shortActionText:shortActionText}}),internalFullMessage:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.logstashVersionMismatch.firing.internalFullMessage",{defaultMessage:"Logstash version mismatch alert is firing for {clusterName}. Logstash is running {versions}. {action}",values:{clusterName:cluster.clusterName,versions:versions,action:action}}),state:AlertingDefaults.ALERT_STATE.firing,clusterName:cluster.clusterName,versionList:versions,action:action,actionPlain:shortActionText})}case 6:case"end":return _context2.stop()}}}),_callee2,this)})));function executeActions(_x6,_x7,_x8,_x9){return _executeActions.apply(this,arguments)}return executeActions}()}]);return LogstashVersionMismatchAlert}(base_alert_BaseAlert);function alerts_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function alerts_factory_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){alerts_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){alerts_factory_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function alerts_factory_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function alerts_factory_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function alerts_factory_createClass(Constructor,protoProps,staticProps){if(protoProps)alerts_factory_defineProperties(Constructor.prototype,protoProps);if(staticProps)alerts_factory_defineProperties(Constructor,staticProps);return Constructor}var BY_TYPE={[constants["a"]]:cluster_health_alert_ClusterHealthAlert,[constants["f"]]:license_expiration_alert_LicenseExpirationAlert,[constants["b"]]:cpu_usage_alert_CpuUsageAlert,[constants["i"]]:missing_monitoring_data_alert_MissingMonitoringDataAlert,[constants["c"]]:disk_usage_alert_DiskUsageAlert,[constants["h"]]:memory_usage_alert_MemoryUsageAlert,[constants["j"]]:nodes_changed_alert_NodesChangedAlert,[constants["g"]]:logstash_version_mismatch_alert_LogstashVersionMismatchAlert,[constants["e"]]:kibana_version_mismatch_alert_KibanaVersionMismatchAlert,[constants["d"]]:elasticsearch_version_mismatch_alert_ElasticsearchVersionMismatchAlert};var AlertsFactory=function(){function AlertsFactory(){alerts_factory_classCallCheck(this,AlertsFactory)}alerts_factory_createClass(AlertsFactory,null,[{key:"getByType",value:function(){var _getByType=alerts_factory_asyncToGenerator(regeneratorRuntime.mark((function _callee(type,alertsClient){var alertCls,alertClientAlerts,rawAlert;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:alertCls=BY_TYPE[type];if(alertCls){_context.next=3;break}return _context.abrupt("return",null);case 3:if(!alertsClient){_context.next=11;break}_context.next=6;return alertsClient.find({options:{filter:"alert.attributes.alertTypeId:".concat(type)}});case 6:alertClientAlerts=_context.sent;if(!(alertClientAlerts.total===0)){_context.next=9;break}return _context.abrupt("return",new alertCls);case 9:rawAlert=alertClientAlerts.data[0];return _context.abrupt("return",new alertCls(rawAlert));case 11:return _context.abrupt("return",new alertCls);case 12:case"end":return _context.stop()}}}),_callee)})));function getByType(_x,_x2){return _getByType.apply(this,arguments)}return getByType}()},{key:"getAll",value:function getAll(){return Object.values(BY_TYPE).map((function(alert){return new alert}))}}]);return AlertsFactory}();function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function createCpuUsageAlertType(){var alert=new cpu_usage_alert_CpuUsageAlert;return{id:constants["b"],name:alert.label,iconClass:"bell",alertParamsExpression:function alertParamsExpression(props){return external_kbnSharedDeps_React_default.a.createElement(expression_Expression,_extends({},props,{paramDetails:cpu_usage_alert_CpuUsageAlert.paramDetails}))},validate:validate,defaultActionMessage:"{{context.internalFullMessage}}",requiresAppContext:true}}function validation_validate(opts){var validationResult={errors:{}};var errors={duration:[],limit:[]};if(!opts.duration){errors.duration.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.validation.duration",{defaultMessage:"A valid duration is required."}))}if(!opts.limit){errors.limit.push(external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.missingData.validation.limit",{defaultMessage:"A valid limit is required."}))}validationResult.errors=errors;return validationResult}var missing_monitoring_data_alert_expression_Expression=function Expression(props){var alertParams=props.alertParams,paramDetails=props.paramDetails,setAlertParams=props.setAlertParams,errors=props.errors;var alertParamsUi=Object.keys(alertParams).map((function(alertParamName){var details=paramDetails[alertParamName];var value=alertParams[alertParamName];switch(details.type){case enums["c"].Duration:return external_kbnSharedDeps_React_default.a.createElement(alert_param_duration_AlertParamDuration,{key:alertParamName,name:alertParamName,duration:value,label:details.label,errors:errors[alertParamName],setAlertParams:setAlertParams});case enums["c"].Percentage:return external_kbnSharedDeps_React_default.a.createElement(alert_param_percentage_AlertParamPercentage,{key:alertParamName,name:alertParamName,label:details.label,percentage:value,errors:errors[alertParamName],setAlertParams:setAlertParams})}}));return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiForm"],{component:"form"},alertParamsUi),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))};function missing_monitoring_data_alert_extends(){missing_monitoring_data_alert_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return missing_monitoring_data_alert_extends.apply(this,arguments)}function createMissingMonitoringDataAlertType(){var alert=new missing_monitoring_data_alert_MissingMonitoringDataAlert;return{id:constants["i"],name:alert.label,iconClass:"bell",alertParamsExpression:function alertParamsExpression(props){return external_kbnSharedDeps_React_default.a.createElement(missing_monitoring_data_alert_expression_Expression,missing_monitoring_data_alert_extends({},props,{paramDetails:missing_monitoring_data_alert_MissingMonitoringDataAlert.paramDetails}))},validate:validation_validate,defaultActionMessage:"{{context.internalFullMessage}}",requiresAppContext:true}}function createLegacyAlertTypes(){return constants["K"].map((function(legacyAlert){var alertCls=BY_TYPE[legacyAlert];var alert=new alertCls;return{id:legacyAlert,name:alert.label,iconClass:"bell",alertParamsExpression:function alertParamsExpression(props){return external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_React_["Fragment"],null,external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiTextColor"],{color:"subdued"},external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.alerts.legacyAlert.expressionText",{defaultMessage:"There is nothing to configure."})),external_kbnSharedDeps_React_default.a.createElement(external_kbnSharedDeps_ElasticEui_["EuiSpacer"],null))},defaultActionMessage:"{{context.internalFullMessage}}",validate:function validate(){return{errors:{}}},requiresAppContext:true}}))}function disk_usage_alert_extends(){disk_usage_alert_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return disk_usage_alert_extends.apply(this,arguments)}function createDiskUsageAlertType(){return{id:disk_usage_alert_DiskUsageAlert.TYPE,name:disk_usage_alert_DiskUsageAlert.LABEL,iconClass:"bell",alertParamsExpression:function alertParamsExpression(props){return external_kbnSharedDeps_React_default.a.createElement(expression_Expression,disk_usage_alert_extends({},props,{paramDetails:disk_usage_alert_DiskUsageAlert.PARAM_DETAILS}))},validate:validate,defaultActionMessage:"{{context.internalFullMessage}}",requiresAppContext:true}}function memory_usage_alert_extends(){memory_usage_alert_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return memory_usage_alert_extends.apply(this,arguments)}function createMemoryUsageAlertType(){return{id:memory_usage_alert_MemoryUsageAlert.TYPE,name:memory_usage_alert_MemoryUsageAlert.LABEL,iconClass:"bell",alertParamsExpression:function alertParamsExpression(props){return external_kbnSharedDeps_React_default.a.createElement(expression_Expression,memory_usage_alert_extends({},props,{paramDetails:memory_usage_alert_MemoryUsageAlert.PARAM_DETAILS}))},validate:validate,defaultActionMessage:"{{context.internalFullMessage}}",requiresAppContext:true}}function plugin_slicedToArray(arr,i){return plugin_arrayWithHoles(arr)||plugin_iterableToArrayLimit(arr,i)||plugin_unsupportedIterableToArray(arr,i)||plugin_nonIterableRest()}function plugin_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function plugin_iterableToArrayLimit(arr,i){if(typeof Symbol==="undefined"||!(Symbol.iterator in Object(arr)))return;var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function plugin_arrayWithHoles(arr){if(Array.isArray(arr))return arr}function plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function plugin_asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){plugin_asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)}))}}function plugin_createForOfIteratorHelper(o,allowArrayLike){var it;if(typeof Symbol==="undefined"||o[Symbol.iterator]==null){if(Array.isArray(o)||(it=plugin_unsupportedIterableToArray(o))||allowArrayLike&&o&&typeof o.length==="number"){if(it)o=it;var i=0;var F=function F(){};return{s:F,n:function n(){if(i>=o.length)return{done:true};return{done:false,value:o[i++]}},e:function e(_e2){throw _e2},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var normalCompletion=true,didErr=false,err;return{s:function s(){it=o[Symbol.iterator]()},n:function n(){var step=it.next();normalCompletion=step.done;return step},e:function e(_e3){didErr=true;err=_e3},f:function f(){try{if(!normalCompletion&&it.return!=null)it.return()}finally{if(didErr)throw err}}}}function plugin_unsupportedIterableToArray(o,minLen){if(!o)return;if(typeof o==="string")return plugin_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(o);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return plugin_arrayLikeToArray(o,minLen)}function plugin_arrayLikeToArray(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++){arr2[i]=arr[i]}return arr2}function plugin_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function plugin_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function plugin_createClass(Constructor,protoProps,staticProps){if(protoProps)plugin_defineProperties(Constructor.prototype,protoProps);if(staticProps)plugin_defineProperties(Constructor,staticProps);return Constructor}var plugin_MonitoringPlugin=function(){function MonitoringPlugin(initializerContext){plugin_classCallCheck(this,MonitoringPlugin);this.initializerContext=initializerContext}plugin_createClass(MonitoringPlugin,[{key:"setup",value:function setup(core,plugins){var _this=this;var home=plugins.home;var id="monitoring";var icon="monitoringApp";var title=external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.stackMonitoringTitle",{defaultMessage:"Stack Monitoring"});var monitoring=this.initializerContext.config.get();if(!monitoring.ui.enabled||!monitoring.enabled){return false}if(home){home.featureCatalogue.register({id:id,title:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.featureCatalogueTitle",{defaultMessage:"Monitor the stack"}),icon:icon,path:"/app/monitoring",showOnHomePage:true,category:public_["FeatureCatalogueCategory"].ADMIN,description:external_kbnSharedDeps_KbnI18n_["i18n"].translate("xpack.monitoring.featureCatalogueDescription",{defaultMessage:"Track the real-time health and performance of your deployment."}),order:610})}var alertTypeRegistry=plugins.triggersActionsUi.alertTypeRegistry;alertTypeRegistry.register(createCpuUsageAlertType());alertTypeRegistry.register(createDiskUsageAlertType());alertTypeRegistry.register(createMemoryUsageAlertType());alertTypeRegistry.register(createMissingMonitoringDataAlertType());var legacyAlertTypes=createLegacyAlertTypes();var _iterator=plugin_createForOfIteratorHelper(legacyAlertTypes),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var legacyAlertType=_step.value;alertTypeRegistry.register(legacyAlertType)}}catch(err){_iterator.e(err)}finally{_iterator.f()}var app={id:id,title:title,order:9030,euiIconType:icon,category:core_public_["DEFAULT_APP_CATEGORIES"].management,mount:function(){var _mount=plugin_asyncToGenerator(regeneratorRuntime.mark((function _callee(params){var _plugins$cloud;var _yield$core$getStartS,_yield$core$getStartS2,coreStart,pluginsStart,_yield$import,AngularApp,deps,monitoringApp,removeHistoryListener;return regeneratorRuntime.wrap((function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return core.getStartServices();case 2:_yield$core$getStartS=_context.sent;_yield$core$getStartS2=plugin_slicedToArray(_yield$core$getStartS,2);coreStart=_yield$core$getStartS2[0];pluginsStart=_yield$core$getStartS2[1];_context.next=8;return Promise.all([__webpack_require__.e(2),__webpack_require__.e(1)]).then(__webpack_require__.bind(null,285));case 8:_yield$import=_context.sent;AngularApp=_yield$import.AngularApp;deps={navigation:pluginsStart.navigation,kibanaLegacy:pluginsStart.kibanaLegacy,element:params.element,core:coreStart,data:pluginsStart.data,isCloud:Boolean((_plugins$cloud=plugins.cloud)===null||_plugins$cloud===void 0?void 0:_plugins$cloud.isCloudEnabled),pluginInitializerContext:_this.initializerContext,externalConfig:_this.getExternalConfig(),triggersActionsUi:plugins.triggersActionsUi,usageCollection:plugins.usageCollection};pluginsStart.kibanaLegacy.loadFontAwesome();_this.setInitialTimefilter(deps);monitoringApp=new AngularApp(deps);removeHistoryListener=params.history.listen((function(location){if(location.pathname===""&&location.hash===""){monitoringApp.applyScope()}}));return _context.abrupt("return",(function(){removeHistoryListener();monitoringApp.destroy()}));case 16:case"end":return _context.stop()}}}),_callee)})));function mount(_x){return _mount.apply(this,arguments)}return mount}()};core.application.register(app);return true}},{key:"start",value:function start(core,plugins){}},{key:"stop",value:function stop(){}},{key:"setInitialTimefilter",value:function setInitialTimefilter(_ref){var coreContext=_ref.core,data=_ref.data;var timefilter=data.query.timefilter.timefilter;var uiSettings=coreContext.uiSettings;var refreshInterval={value:1e4,pause:false};var time={from:"now-1h",to:"now"};timefilter.setRefreshInterval(refreshInterval);timefilter.setTime(time);uiSettings.overrideLocalDefault(data_public_["UI_SETTINGS"].TIMEPICKER_REFRESH_INTERVAL_DEFAULTS,JSON.stringify(refreshInterval));uiSettings.overrideLocalDefault(data_public_["UI_SETTINGS"].TIMEPICKER_TIME_DEFAULTS,JSON.stringify(time))}},{key:"getExternalConfig",value:function getExternalConfig(){var monitoring=this.initializerContext.config.get();return[["minIntervalSeconds",monitoring.ui.min_interval_seconds],["showLicenseExpiration",monitoring.ui.show_license_expiration],["showCgroupMetricsElasticsearch",monitoring.ui.container.elasticsearch.enabled],["showCgroupMetricsLogstash",monitoring.ui.container.logstash.enabled]]}}]);return MonitoringPlugin}();function public_plugin(ctx){return new plugin_MonitoringPlugin(ctx)}},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nReact},function(module,exports){module.exports=__kbnSharedDeps__.ReactDom},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaReact/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.ElasticNumeral},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaLegacy/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.Jquery},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/kibanaUtils/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.Angular},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/observability/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.MomentTimezone},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/triggersActionsUi/public");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.Rxjs},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/alerts/common");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.ElasticEuiLibServices},function(module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var ns=__kbnBundles__.get("plugin/licenseManagement/common/constants");Object.defineProperties(__webpack_exports__,Object.getOwnPropertyDescriptors(ns))},function(module,exports){module.exports=__kbnSharedDeps__.KbnI18nAngular}]);